(()=>{"use strict";var e={5129:(e,t,a)=>{a(3792),a(3362),a(9085),a(9391);var r=a(5130),n=a(6768);function s(e,t,a,r,s,i){var u=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.Wv)(u)}const i={name:"App"};var u=a(1241);const o=(0,u.A)(i,[["render",s]]),c=o;a(2010);var l=a(1387),d={class:"welcome-page"},p={class:"welcome-content"},v={class:"cta-container"};function f(e,t,a,r,s,i){var u=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",p,[t[2]||(t[2]=(0,n.Fv)('<div class="welcome-text" data-v-7db771de><h1 class="welcome-heading" data-v-7db771de>Bienvenue sur ChitChat</h1><p class="welcome-tagline" data-v-7db771de>Connectez-vous, discutez et communiquez facilement</p><div class="welcome-line" data-v-7db771de></div></div><div class="hero-section" data-v-7db771de><div class="features-column" data-v-7db771de><div class="feature-card" data-v-7db771de><div class="icon-container" data-v-7db771de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-7db771de><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" data-v-7db771de></path></svg></div><h3 data-v-7db771de>Messagerie instantanée</h3><p data-v-7db771de>Discutez avec vos amis en temps réel</p></div><div class="feature-card" data-v-7db771de><div class="icon-container" data-v-7db771de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-7db771de><circle cx="12" cy="12" r="10" data-v-7db771de></circle><line x1="2" y1="12" x2="22" y2="12" data-v-7db771de></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" data-v-7db771de></path></svg></div><h3 data-v-7db771de>Communauté mondiale</h3><p data-v-7db771de>Connectez-vous avec des personnes du monde entier</p></div></div><div class="phone-container" data-v-7db771de><div class="phone-frame" data-v-7db771de><div class="phone-header" data-v-7db771de><div class="phone-notch" data-v-7db771de></div></div><div class="phone-screen" data-v-7db771de><div class="app-header" data-v-7db771de><div class="app-title" data-v-7db771de>ChitChat</div></div><div class="message-container" data-v-7db771de><div class="message received" data-v-7db771de><div class="message-content" data-v-7db771de>Salut ! Comment ça va ?</div><div class="message-time" data-v-7db771de>10:24</div></div><div class="message sent" data-v-7db771de><div class="message-content" data-v-7db771de>Je vais super bien ! Je teste juste cette nouvelle application ChitChat.</div><div class="message-time" data-v-7db771de>10:25</div></div><div class="message received message-typing" data-v-7db771de><div class="typing-indicator" data-v-7db771de><span data-v-7db771de></span><span data-v-7db771de></span><span data-v-7db771de></span></div></div></div><div class="message-input" data-v-7db771de><input type="text" placeholder="Tapez un message..." readonly data-v-7db771de><button class="send-button" data-v-7db771de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-7db771de><line x1="22" y1="2" x2="11" y2="13" data-v-7db771de></line><polygon points="22 2 15 22 11 13 2 9 22 2" data-v-7db771de></polygon></svg></button></div></div></div></div><div class="features-column" data-v-7db771de><div class="feature-card" data-v-7db771de><div class="icon-container" data-v-7db771de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-7db771de><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" data-v-7db771de></path></svg></div><h3 data-v-7db771de>Conversations sécurisées</h3><p data-v-7db771de>Chiffrement de bout en bout pour votre confidentialité</p></div><div class="feature-card" data-v-7db771de><div class="icon-container" data-v-7db771de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-7db771de><rect x="2" y="2" width="20" height="20" rx="5" ry="5" data-v-7db771de></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" data-v-7db771de></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" data-v-7db771de></line></svg></div><h3 data-v-7db771de>Partage de médias</h3><p data-v-7db771de>Partagez instantanément des photos et des vidéos</p></div></div></div>',2)),(0,n.Lk)("div",v,[(0,n.bF)(u,{to:"/login",class:"cta-button primary"},{default:(0,n.k6)((function(){return t[0]||(t[0]=[(0,n.eW)("Commencer")])})),_:1}),t[1]||(t[1]=(0,n.Lk)("button",{class:"cta-button secondary"},"En savoir plus",-1))])])])}a(1629),a(8111),a(7588),a(6099),a(3500),a(6031);const m={name:"WelcomePage",mounted:function(){setTimeout((function(){var e=document.querySelectorAll(".welcome-page .message");e.forEach((function(e,t){setTimeout((function(){e.classList.add("visible")}),1e3*t)}))}),500)}},g=(0,u.A)(m,[["render",f],["__scopeId","data-v-7db771de"]]),k=g;var h={class:"login-container"},b={class:"login-form"},x={class:"auth-links"};function w(e,t,a,s,i,u){var o=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",h,[t[6]||(t[6]=(0,n.Lk)("h1",{class:"app-title"},"Bienvenue sur notre ChatAPP",-1)),(0,n.Lk)("div",b,[(0,n.bo)((0,n.Lk)("input",{type:"email",placeholder:"Adresse e-mail","onUpdate:modelValue":t[0]||(t[0]=function(e){return i.email=e}),class:"input-field"},null,512),[[r.Jo,i.email]]),(0,n.bo)((0,n.Lk)("input",{type:"password",placeholder:"Entrez votre mot de passe","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.password=e}),class:"input-field"},null,512),[[r.Jo,i.password]]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=function(){return u.login&&u.login.apply(u,arguments)}),class:"login-button"},"Se connecter"),(0,n.Lk)("div",x,[t[5]||(t[5]=(0,n.Lk)("p",{class:"no-account"},"Vous n'avez pas de compte ?",-1)),(0,n.bF)(o,{to:"/signup",class:"signup-link"},{default:(0,n.k6)((function(){return t[3]||(t[3]=[(0,n.eW)("S'inscrire")])})),_:1}),(0,n.bF)(o,{to:"/forgot",class:"forgot-link"},{default:(0,n.k6)((function(){return t[4]||(t[4]=[(0,n.eW)("Mot de passe oublié ?")])})),_:1})])])])}var y=a(4048),L=a(388),C=(a(4114),a(3831)),A=a(7617);const P={name:"LoginPage",data:function(){return{email:"",password:""}},methods:{login:function(){var e=this;return(0,L.A)((0,y.A)().mark((function t(){var a,r,n,s;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=(0,C.xI)(),t.next=4,(0,C.x9)(a,e.email,e.password);case 4:return r=t.sent,n=r.user.uid,s=(0,A.aU)(),t.next=9,(0,A.mZ)((0,A.H9)(s,"users",n),{isOnline:!0});case 9:e.$router.push("/forum/".concat(n)),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),console.error("Login error:",t.t0),alert("Login failed: "+t.t0.message);case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()}}},E=(0,u.A)(P,[["render",w],["__scopeId","data-v-29560894"]]),U=E;var I={class:"signup-container"},D={class:"signup-form"},R={class:"login-link-container"};function M(e,t,a,s,i,u){var o=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",I,[t[6]||(t[6]=(0,n.Lk)("h1",{class:"page-title"},"Page d'inscription",-1)),(0,n.Lk)("div",D,[(0,n.bo)((0,n.Lk)("input",{type:"email",placeholder:"entrez votre e-mail","onUpdate:modelValue":t[0]||(t[0]=function(e){return i.Email=e}),class:"input-field"},null,512),[[r.Jo,i.Email]]),(0,n.bo)((0,n.Lk)("input",{type:"text",placeholder:"entrez votre prénom","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.FirstName=e}),class:"input-field"},null,512),[[r.Jo,i.FirstName]]),(0,n.bo)((0,n.Lk)("input",{type:"text",placeholder:"entrez votre nom","onUpdate:modelValue":t[2]||(t[2]=function(e){return i.LastName=e}),class:"input-field"},null,512),[[r.Jo,i.LastName]]),(0,n.bo)((0,n.Lk)("input",{type:"password",placeholder:"entrez votre mot de passe","onUpdate:modelValue":t[3]||(t[3]=function(e){return i.Password=e}),class:"input-field"},null,512),[[r.Jo,i.Password]]),(0,n.Lk)("button",{onClick:t[4]||(t[4]=function(){return u.Signup&&u.Signup.apply(u,arguments)}),class:"signup-button"},"S'inscrire"),(0,n.Lk)("div",R,[(0,n.bF)(o,{to:"/login",class:"login-link"},{default:(0,n.k6)((function(){return t[5]||(t[5]=[(0,n.eW)("Vous avez déjà un compte ? Se connecter")])})),_:1})])])])}a(9449);const K={name:"SignUp",data:function(){return{FirstName:"",LastName:"",Password:"",Email:""}},methods:{isUM6PEmail:function(e){return e.toLowerCase().endsWith("@um6p.ma")},Signup:function(){var e=this;return(0,L.A)((0,y.A)().mark((function t(){var a,r,n,s;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.isUM6PEmail(e.Email)){t.next=13;break}return a=(0,C.xI)(),r=(0,A.aU)(),t.next=6,(0,C.eJ)(a,e.Email,e.Password);case 6:return n=t.sent,s=n.user.uid,t.next=10,(0,A.BN)((0,A.H9)(r,"users",s),{FirstName:e.FirstName,LastName:e.LastName,Email:e.Email,isOnline:!0,createdAt:(0,A.O5)()});case 10:e.$router.push("/forum/".concat(s)),t.next=14;break;case 13:alert("The Email should be in um6p domain");case 14:t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error("Signup error:",t.t0),"auth/email-already-in-use"===t.t0.code?alert("This email is already registered. Please use a different email or login instead."):alert("Signup failed: "+t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()}}},X=(0,u.A)(K,[["render",M],["__scopeId","data-v-6fd4fba0"]]),F=X;var N=a(4232),_={class:"forum-layout"},V={class:"top-nav"},S={class:"user-info"},B=["src"],O={class:"username"},j={class:"forum-content"},z={class:"left-panel"},T={class:"create-buttons"},H={class:"filter-buttons"},J={key:0,class:"right-panel"},Q={key:1,class:"right-panel join-prompt"},W={key:2,class:"right-panel"},G={key:0,class:"modal"},q={class:"modal-content"},Z={class:"modal-buttons"},Y={key:1,class:"modal"},$={class:"modal-content"},ee={key:0,class:"image-preview"},te=["src"],ae={class:"participant-emails"},re={key:1,class:"email-list"},ne=["onClick"],se={class:"modal-buttons"},ie={key:2,class:"modal"},ue={class:"modal-content"},oe={class:"profile-pic-preview"},ce=["src"],le={class:"modal-buttons"};function de(e,t,a,s,i,u){var o=(0,n.g2)("router-link"),c=(0,n.g2)("SingleDisc"),l=(0,n.g2)("Responses");return(0,n.uX)(),(0,n.CE)("div",_,[(0,n.Lk)("div",V,[(0,n.Lk)("div",S,[(0,n.bF)(o,{to:"/profile/".concat(s.userId),class:"profile-link"},{default:(0,n.k6)((function(){return[(0,n.Lk)("img",{src:s.profileImageUrl||"/api/placeholder/32/32",alt:"Profile",class:"profile-image"},null,8,B),(0,n.Lk)("span",O,(0,N.v_)(s.FirstName)+" "+(0,N.v_)(s.LastName),1),(0,n.Lk)("span",{class:(0,N.C4)(["status-dot",{online:s.isOnline}])},null,2)]})),_:1},8,["to"])]),(0,n.Lk)("button",{onClick:t[0]||(t[0]=function(){return s.logout&&s.logout.apply(s,arguments)}),class:"logout-btn"},"Déconnexion")]),(0,n.Lk)("div",j,[(0,n.Lk)("div",z,[(0,n.Lk)("div",T,[(0,n.Lk)("button",{onClick:t[1]||(t[1]=function(){return s.openCreatePrivateDialog&&s.openCreatePrivateDialog.apply(s,arguments)}),class:"create-button private-btn"},t[23]||(t[23]=[(0,n.Lk)("span",{class:"icon"},"+",-1),(0,n.eW)(" Créer une discussion privée ")])),(0,n.Lk)("button",{onClick:t[2]||(t[2]=function(){return s.openCreatePublicDialog&&s.openCreatePublicDialog.apply(s,arguments)}),class:"create-button public-btn"},t[24]||(t[24]=[(0,n.Lk)("span",{class:"icon"},"+",-1),(0,n.eW)(" Créer une discussion publique ")]))]),(0,n.Lk)("div",H,[(0,n.Lk)("button",{onClick:t[3]||(t[3]=function(){return s.showAll&&s.showAll.apply(s,arguments)}),class:(0,N.C4)({active:"all"===s.filterType})},"Tous",2),(0,n.Lk)("button",{onClick:t[4]||(t[4]=function(){return s.showPrivate&&s.showPrivate.apply(s,arguments)}),class:(0,N.C4)({active:"private"===s.filterType})},"Privés",2),(0,n.Lk)("button",{onClick:t[5]||(t[5]=function(){return s.showPublic&&s.showPublic.apply(s,arguments)}),class:(0,N.C4)({active:"public"===s.filterType})},"Publics",2)]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.filteredDiscussions,(function(e){return(0,n.uX)(),(0,n.Wv)(c,{key:e.id,"discussion-id":e.id,"is-participant":s.isParticipant(e),"is-active":s.currentDiscussionId===e.id,"creator-pic":e.creatorPic,onViewDiscussion:s.handleViewDiscussion,onJoinDiscussion:s.joinDiscussion,onLeaveDiscussion:s.leaveDiscussion},null,8,["discussion-id","is-participant","is-active","creator-pic","onViewDiscussion","onJoinDiscussion","onLeaveDiscussion"])})),128))]),s.currentDiscussionId&&s.canViewDiscussion?((0,n.uX)(),(0,n.CE)("div",J,[(0,n.bF)(l,{discussionId:s.currentDiscussionId,onHideDiscussion:s.hideDiscussion},null,8,["discussionId","onHideDiscussion"])])):s.currentDiscussionId&&!s.canViewDiscussion?((0,n.uX)(),(0,n.CE)("div",Q,[t[25]||(t[25]=(0,n.Lk)("h3",null,"Vous n'êtes pas un participant de cette discussion",-1)),t[26]||(t[26]=(0,n.Lk)("p",null,"Pour voir les détails et participer, veuillez rejoindre la discussion.",-1)),(0,n.Lk)("button",{onClick:t[6]||(t[6]=function(e){return s.joinDiscussion(s.currentDiscussionId)}),class:"join-button"},"Rejoindre la discussion")])):((0,n.uX)(),(0,n.CE)("div",W," Sélectionnez une discussion pour voir les réponses "))]),s.showPrivateDialog?((0,n.uX)(),(0,n.CE)("div",G,[(0,n.Lk)("div",q,[t[27]||(t[27]=(0,n.Lk)("h3",null,"Créer une discussion privée",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=function(e){return s.newDiscPrivateTitle=e}),placeholder:"Titre de la discussion"},null,512),[[r.Jo,s.newDiscPrivateTitle]]),(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=function(e){return s.newDiscPrivateDescription=e}),placeholder:"Description",rows:"3"},null,512),[[r.Jo,s.newDiscPrivateDescription]]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=function(e){return s.newDiscParticipantEmail=e}),placeholder:"Email du participant"},null,512),[[r.Jo,s.newDiscParticipantEmail]]),(0,n.Lk)("div",Z,[(0,n.Lk)("button",{onClick:t[10]||(t[10]=function(){return s.createPrivateDiscussion&&s.createPrivateDiscussion.apply(s,arguments)})},"Créer"),(0,n.Lk)("button",{onClick:t[11]||(t[11]=function(){return s.closeModals&&s.closeModals.apply(s,arguments)})},"Annuler")])])])):(0,n.Q3)("",!0),s.showPublicDialog?((0,n.uX)(),(0,n.CE)("div",Y,[(0,n.Lk)("div",$,[t[28]||(t[28]=(0,n.Lk)("h3",null,"Créer une discussion publique",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=function(e){return s.newDiscPublicTitle=e}),placeholder:"Titre de la discussion"},null,512),[[r.Jo,s.newDiscPublicTitle]]),(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=function(e){return s.newDiscPublicDescription=e}),placeholder:"Description",rows:"3"},null,512),[[r.Jo,s.newDiscPublicDescription]]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[14]||(t[14]=function(e){return s.newDiscPublicImageUrl=e}),placeholder:"URL de l'image (https://...)"},null,512),[[r.Jo,s.newDiscPublicImageUrl]]),s.newDiscPublicImageUrl?((0,n.uX)(),(0,n.CE)("div",ee,[(0,n.Lk)("img",{src:s.newDiscPublicImageUrl||"/api/placeholder/100/100",alt:"Preview",class:"preview-image"},null,8,te)])):(0,n.Q3)("",!0),(0,n.Lk)("div",ae,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[15]||(t[15]=function(e){return s.newParticipantEmail=e}),placeholder:"Email d'un participant (optionnel)",onKeyup:t[16]||(t[16]=(0,r.jR)((function(){return s.addParticipantEmail&&s.addParticipantEmail.apply(s,arguments)}),["enter"]))},null,544),[[r.Jo,s.newParticipantEmail]]),(0,n.Lk)("button",{onClick:t[17]||(t[17]=function(){return s.addParticipantEmail&&s.addParticipantEmail.apply(s,arguments)})},"Ajouter")]),s.participantEmails.length>0?((0,n.uX)(),(0,n.CE)("div",re,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.participantEmails,(function(e,t){return(0,n.uX)(),(0,n.CE)("div",{key:t,class:"email-tag"},[(0,n.eW)((0,N.v_)(e)+" ",1),(0,n.Lk)("span",{class:"remove-email",onClick:function(e){return s.removeParticipantEmail(t)}},"×",8,ne)])})),128))])):(0,n.Q3)("",!0),(0,n.Lk)("div",se,[(0,n.Lk)("button",{onClick:t[18]||(t[18]=function(){return s.createPublicDiscussion&&s.createPublicDiscussion.apply(s,arguments)})},"Créer"),(0,n.Lk)("button",{onClick:t[19]||(t[19]=function(){return s.closeModals&&s.closeModals.apply(s,arguments)})},"Annuler")])])])):(0,n.Q3)("",!0),s.showProfilePicDialog?((0,n.uX)(),(0,n.CE)("div",ie,[(0,n.Lk)("div",ue,[t[29]||(t[29]=(0,n.Lk)("h3",null,"Mettre à jour votre photo de profil",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[20]||(t[20]=function(e){return s.profilePicInput=e}),placeholder:"URL de l'image (https://...)"},null,512),[[r.Jo,s.profilePicInput]]),(0,n.Lk)("div",oe,[(0,n.Lk)("img",{src:s.profilePicInput||s.profileImageUrl||"/api/placeholder/100/100",alt:"Preview",class:"preview-image"},null,8,ce)]),(0,n.Lk)("div",le,[(0,n.Lk)("button",{onClick:t[21]||(t[21]=function(){return s.updateProfilePicture&&s.updateProfilePicture.apply(s,arguments)})},"Sauvegarder"),(0,n.Lk)("button",{onClick:t[22]||(t[22]=function(){return s.closeProfilePicDialog&&s.closeProfilePicDialog.apply(s,arguments)})},"Annuler")])])])):(0,n.Q3)("",!0)])}var pe=a(3604),ve=a(8653),fe=(a(6280),a(6918),a(8706),a(2008),a(113),a(8980),a(4423),a(4346),a(8598),a(2062),a(4554),a(3609),a(3288),a(2489),a(116),a(1701),a(1699),a(7764),a(2762),a(2953),a(144)),me=(a(2675),a(9463),{key:0,class:"user-profile"}),ge=["src","alt"],ke={key:1,class:"fallback-avatar"},he={key:2,class:"online-status"},be={key:1,class:"discussion-icon"},xe=["src"],we=["src"],ye={key:2,class:"default-icon"},Le={class:"discussion-content"},Ce={class:"discussion-header"},Ae={class:"discussion-title"},Pe={key:0,class:"participant-name"},Ee={class:"discussion-description"},Ue={class:"discussion-meta"},Ie={key:0,class:"message-count"},De={key:1,class:"last-activity"},Re={class:"discussion-actions"};function Me(e,t,a,s,i,u){var o;return(0,n.uX)(),(0,n.CE)("div",{class:(0,N.C4)(["discussion-item",{active:a.isActive}]),onClick:t[3]||(t[3]=function(){return s.viewDiscussion&&s.viewDiscussion.apply(s,arguments)})},[s.discussion.isPrivate?((0,n.uX)(),(0,n.CE)("div",me,[s.otherParticipant&&s.otherParticipant.profileImageUrl?((0,n.uX)(),(0,n.CE)("img",{key:0,src:s.otherParticipant.profileImageUrl,alt:"".concat(s.otherParticipant.firstName," ").concat(s.otherParticipant.lastName),class:"profile-pic"},null,8,ge)):((0,n.uX)(),(0,n.CE)("div",ke,(0,N.v_)(s.otherParticipant?s.getInitials(s.otherParticipant.firstName,s.otherParticipant.lastName):"?"),1)),null!==(o=s.otherParticipant)&&void 0!==o&&o.isOnline?((0,n.uX)(),(0,n.CE)("span",he)):(0,n.Q3)("",!0)])):((0,n.uX)(),(0,n.CE)("div",be,[s.discussion.creatorPic?((0,n.uX)(),(0,n.CE)("img",{key:0,src:s.discussion.creatorPic,alt:"Creator",class:"profile-pic"},null,8,xe)):s.discussion.imageUrl?((0,n.uX)(),(0,n.CE)("img",{key:1,src:s.discussion.imageUrl,alt:"Discussion",class:"discussion-img"},null,8,we)):((0,n.uX)(),(0,n.CE)("div",ye,"👥"))])),(0,n.Lk)("div",Le,[(0,n.Lk)("div",Ce,[(0,n.Lk)("h3",Ae,[(0,n.eW)((0,N.v_)(s.discussion.title)+" ",1),s.discussion.isPrivate&&s.otherParticipant?((0,n.uX)(),(0,n.CE)("span",Pe," ("+(0,N.v_)(s.otherParticipant.firstName)+" "+(0,N.v_)(s.otherParticipant.lastName)+") ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",{class:(0,N.C4)(["discussion-type",{private:s.discussion.isPrivate}])},(0,N.v_)(s.discussion.isPrivate?"Privé":"Public"),3)]),(0,n.Lk)("p",Ee,(0,N.v_)(s.discussion.description),1),(0,n.Lk)("div",Ue,[void 0!==s.discussion.messageCount?((0,n.uX)(),(0,n.CE)("span",Ie,(0,N.v_)(s.discussion.messageCount)+" message"+(0,N.v_)(1!==s.discussion.messageCount?"s":""),1)):(0,n.Q3)("",!0),s.discussion.lastActivity?((0,n.uX)(),(0,n.CE)("span",De,(0,N.v_)(s.formatDate(s.discussion.lastActivity)),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",Re,[a.isParticipant?((0,n.uX)(),(0,n.CE)("button",{key:1,onClick:t[1]||(t[1]=(0,r.D$)((function(){return s.leaveDiscussion&&s.leaveDiscussion.apply(s,arguments)}),["stop"])),class:"leave-btn"}," Quitter ")):((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:t[0]||(t[0]=(0,r.D$)((function(){return s.joinDiscussion&&s.joinDiscussion.apply(s,arguments)}),["stop"])),class:"join-btn"}," Rejoindre ")),(0,n.Lk)("button",{onClick:t[2]||(t[2]=(0,r.D$)((function(){return s.viewDiscussion&&s.viewDiscussion.apply(s,arguments)}),["stop"])),class:"view-btn"}," Voir ")])])],2)}const Ke={props:{discussionId:{type:String,required:!0},isParticipant:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1}},emits:["view-discussion","join-discussion","leave-discussion"],setup:function(e,t){var a=t.emit,r=(0,fe.KR)({}),s=(0,fe.KR)(!0),i=(0,fe.KR)(null),u=(0,fe.KR)(null);(0,n.sV)((function(){var e=(0,C.xI)();e.currentUser&&(u.value=e.currentUser.uid),o()})),(0,n.wB)((function(){return e.discussionId}),(function(){o()}));var o=function(){var t=(0,L.A)((0,y.A)().mark((function t(){var a,n;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=(0,A.aU)(),t.next=4,(0,A.x7)((0,A.H9)(a,"discussions",e.discussionId));case 4:if(n=t.sent,!n.exists()){t.next=10;break}if(r.value=(0,ve.A)({id:n.id},n.data()),!r.value.isPrivate||!r.value.participants){t.next=10;break}return t.next=10,c();case 10:s.value=!1,t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](0),console.error("Error fetching discussion:",t.t0),s.value=!1;case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(){return t.apply(this,arguments)}}(),c=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,n,s;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r.value.participants&&u.value){e.next=2;break}return e.abrupt("return");case 2:if(t=r.value.participants.find((function(e){return e!==u.value})),!t){e.next=15;break}return e.prev=4,a=(0,A.aU)(),e.next=8,(0,A.x7)((0,A.H9)(a,"users",t));case 8:n=e.sent,n.exists()&&(s=n.data(),i.value={id:t,firstName:s.firstName||"",lastName:s.lastName||"",profileImageUrl:s.profileImageUrl||null,isOnline:s.isOnline||!1}),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](4),console.error("Error fetching other participant:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),l=function(e,t){var a="";return e&&(a+=e.charAt(0).toUpperCase()),t&&(a+=t.charAt(0).toUpperCase()),a||"?"},d=function(e){if(!e)return"";var t=e.toDate?e.toDate():new Date(e);return t.toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})},p=function(){a("view-discussion",e.discussionId)},v=function(){a("join-discussion",e.discussionId)},f=function(){a("leave-discussion",e.discussionId,r.value.isPrivate)};return{discussion:r,loading:s,otherParticipant:i,getInitials:l,formatDate:d,viewDiscussion:p,joinDiscussion:v,leaveDiscussion:f}}},Xe=(0,u.A)(Ke,[["render",Me],["__scopeId","data-v-9a384d66"]]),Fe=Xe;a(9432);var Ne={key:0},_e={key:0,class:"chat-container"},Ve={class:"discussion-header"},Se={key:0},Be={class:"participants-bar"},Oe={class:"participants-list"},je={class:"participant-avatar"},ze=["src"],Te={key:1,class:"user-initials"},He={class:"participant-name"},Je={key:0,class:"no-messages"},Qe=["data-message-id"],We={class:"message-avatar"},Ge={class:"user-avatar"},qe=["src"],Ze={key:1,class:"avatar-placeholder"},Ye={class:"message-bubble"},$e={key:0,class:"edit-message-container"},et=["onKeyup"],tt={class:"edit-actions"},at=["onClick"],rt={key:1,class:"message-content"},nt={key:0,class:"edited-indicator"},st={class:"message-reactions"},it={key:0,class:"reactions-list"},ut=["onClick"],ot={class:"reaction-emoji"},ct={class:"reaction-count"},lt={class:"message-meta"},dt={class:"user-info"},pt={class:"user-name"},vt={key:0,class:"timestamp"},ft={key:0,class:"message-actions"},mt=["onClick"],gt=["onClick"],kt=["onClick"],ht=["onMouseenter"],bt={key:0,class:"read-count"},xt={class:"read-receipts-content"},wt={key:0},yt={class:"read-users-list"},Lt={class:"read-user-name"},Ct={class:"read-timestamp"},At={key:1},Pt={class:"unread-users-list"},Et={key:2},Ut={class:"reaction-picker-content"},It=["onClick"],Dt={key:3,class:"delete-confirmation-modal"},Rt={class:"delete-modal-content"},Mt={class:"delete-modal-actions"},Kt={class:"message-input-container"},Xt={key:1,class:"loading"},Ft={key:1,class:"no-discussion-selected"};function Nt(e,t,a,s,i,u){return a.discussionId?((0,n.uX)(),(0,n.CE)("div",Ne,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=function(){return s.Hide&&s.Hide.apply(s,arguments)}),class:"back-button"},t[10]||(t[10]=[(0,n.Lk)("span",{class:"back-icon"},"←",-1),(0,n.eW)(" Retour aux discussions ")])),s.discussion?((0,n.uX)(),(0,n.CE)("div",_e,[(0,n.Lk)("div",Ve,[(0,n.Lk)("h2",null,(0,N.v_)(s.discussion.title),1),s.discussion.description?((0,n.uX)(),(0,n.CE)("p",Se,(0,N.v_)(s.discussion.description),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",Be,[t[11]||(t[11]=(0,n.Lk)("div",{class:"participants-label"},"Participants",-1)),(0,n.Lk)("div",Oe,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.discussion.participants,(function(e){return(0,n.uX)(),(0,n.CE)("div",{key:e,class:"participant-item"},[(0,n.Lk)("div",je,[s.userAvatars[e]?((0,n.uX)(),(0,n.CE)("img",{key:0,src:s.userAvatars[e],alt:"Avatar",class:"avatar-img"},null,8,ze)):((0,n.uX)(),(0,n.CE)("div",Te,(0,N.v_)(s.getUserInitials(e)),1)),(0,n.Lk)("div",{class:(0,N.C4)(["status-indicator",{online:s.isUserOnline(e),offline:!s.isUserOnline(e)}])},null,2)]),(0,n.Lk)("div",He,(0,N.v_)(s.isCurrentUser(e)?"Vous":s.userNames[e]||"Utilisateur"),1)])})),128))])]),(0,n.Lk)("div",{class:"messages-container",ref:"messagesContainer",onScroll:t[7]||(t[7]=function(){return s.handleScroll&&s.handleScroll.apply(s,arguments)})},[0===s.responses.length?((0,n.uX)(),(0,n.CE)("div",Je," Aucun message dans cette discussion. Soyez le premier à écrire ! ")):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.responses,(function(e){return(0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,N.C4)([{"sender-message":s.isCurrentUserMessage(e),"receiver-message":!s.isCurrentUserMessage(e)},"message"]),"data-message-id":e.id,ref_for:!0,ref:"messageElements"},[(0,n.Lk)("div",We,[(0,n.Lk)("div",Ge,[s.userAvatars[e.senderId]?((0,n.uX)(),(0,n.CE)("img",{key:0,src:s.userAvatars[e.senderId],alt:"Avatar",class:"avatar-img"},null,8,qe)):((0,n.uX)(),(0,n.CE)("div",Ze,(0,N.v_)(s.getUserInitials(e.senderId)),1))])]),(0,n.Lk)("div",Ye,[s.editingMessageId===e.id?((0,n.uX)(),(0,n.CE)("div",$e,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=function(e){return s.editMessageContent=e}),class:"edit-message-input",ref_for:!0,ref:"editTextarea",onKeyup:[(0,r.jR)((0,r.D$)((function(t){return s.saveMessageEdit(e.id)}),["exact"]),["enter"]),t[2]||(t[2]=(0,r.jR)((function(){return s.cancelMessageEdit&&s.cancelMessageEdit.apply(s,arguments)}),["escape"]))]},null,40,et),[[r.Jo,s.editMessageContent]]),(0,n.Lk)("div",tt,[(0,n.Lk)("button",{onClick:function(t){return s.saveMessageEdit(e.id)},class:"edit-save-btn"},"Enregistrer",8,at),(0,n.Lk)("button",{onClick:t[3]||(t[3]=function(){return s.cancelMessageEdit&&s.cancelMessageEdit.apply(s,arguments)}),class:"edit-cancel-btn"},"Annuler")])])):((0,n.uX)(),(0,n.CE)("div",rt,[(0,n.eW)((0,N.v_)(e.content)+" ",1),e.edited?((0,n.uX)(),(0,n.CE)("span",nt,"(modifié)")):(0,n.Q3)("",!0)])),(0,n.Lk)("div",st,[e.reactions&&Object.keys(e.reactions).length>0?((0,n.uX)(),(0,n.CE)("div",it,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.reactions,(function(t,a){return(0,n.uX)(),(0,n.CE)("div",{key:a,class:(0,N.C4)(["reaction-badge",{"user-reacted":s.hasUserReacted(e,a)}]),onClick:function(t){return s.toggleReaction(e.id,a)}},[(0,n.Lk)("span",ot,(0,N.v_)(a),1),(0,n.Lk)("span",ct,(0,N.v_)(Object.keys(t).length),1)],10,ut)})),128))])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",lt,[(0,n.Lk)("div",dt,[(0,n.Lk)("span",pt,(0,N.v_)(s.isCurrentUserMessage(e)?"Vous":s.getUserDisplayName(e.senderId)),1),e.createdAt?((0,n.uX)(),(0,n.CE)("span",vt,(0,N.v_)(s.formatDate(e.createdAt)),1)):(0,n.Q3)("",!0)]),s.editingMessageId?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",ft,[s.isCurrentUserMessage(e)?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:function(t){return s.startEditMessage(e)},class:"action-btn",title:"Modifier ce message"},t[12]||(t[12]=[(0,n.Lk)("span",{class:"edit-icon"},"✎",-1)]),8,mt)):(0,n.Q3)("",!0),s.isCurrentUserMessage(e)?((0,n.uX)(),(0,n.CE)("button",{key:1,onClick:function(t){return s.confirmDeleteMessage(e.id)},class:"action-btn delete-btn",title:"Supprimer ce message"},t[13]||(t[13]=[(0,n.Lk)("span",{class:"delete-icon"},"🗑️",-1)]),8,gt)):(0,n.Q3)("",!0),(0,n.Lk)("button",{onClick:function(t){return s.showReactionPicker(e.id)},class:"action-btn",title:"Réagir à ce message"},t[14]||(t[14]=[(0,n.Lk)("span",{class:"reaction-icon"},"😀",-1)]),8,kt),s.isCurrentUserMessage(e)?((0,n.uX)(),(0,n.CE)("div",{key:2,class:"read-status",onMouseenter:function(t){return s.showReadReceipts(e)},onMouseleave:t[4]||(t[4]=function(e){return s.hideReadReceipts()})},[(0,n.Lk)("span",{class:(0,N.C4)(["read-status-icon",s.getReadStatusClass(e)])},[s.getReadCount(e)>0?((0,n.uX)(),(0,n.CE)("span",bt,(0,N.v_)(s.getReadCount(e)),1)):(0,n.Q3)("",!0)],2)],40,ht)):(0,n.Q3)("",!0)]))])])],10,Qe)})),128)),s.showingReadReceiptsFor?((0,n.uX)(),(0,n.CE)("div",{key:1,class:"read-receipts-tooltip",style:(0,N.Tr)(s.readReceiptsTooltipStyle)},[(0,n.Lk)("div",xt,[s.getReadUsersList(s.showingReadReceiptsFor).length>0?((0,n.uX)(),(0,n.CE)("div",wt,[t[15]||(t[15]=(0,n.Lk)("strong",null,"Lu par:",-1)),(0,n.Lk)("ul",yt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.getReadUsersList(s.showingReadReceiptsFor),(function(e,t){return(0,n.uX)(),(0,n.CE)("li",{key:t,class:"read-user-item"},[(0,n.Lk)("span",Lt,(0,N.v_)(e.name),1),(0,n.Lk)("span",Ct,(0,N.v_)(s.formatDate(e.timestamp)),1)])})),128))])])):(0,n.Q3)("",!0),s.getUnreadUsersList(s.showingReadReceiptsFor).length>0?((0,n.uX)(),(0,n.CE)("div",At,[t[16]||(t[16]=(0,n.Lk)("strong",null,"Pas encore lu par:",-1)),(0,n.Lk)("ul",Pt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.getUnreadUsersList(s.showingReadReceiptsFor),(function(e,t){return(0,n.uX)(),(0,n.CE)("li",{key:t,class:"unread-user-item"},(0,N.v_)(e),1)})),128))])])):(0,n.Q3)("",!0),0===s.getReadUsersList(s.showingReadReceiptsFor).length&&0===s.getUnreadUsersList(s.showingReadReceiptsFor).length?((0,n.uX)(),(0,n.CE)("div",Et," Aucune information de lecture disponible. ")):(0,n.Q3)("",!0)])],4)):(0,n.Q3)("",!0),s.showingReactionsFor?((0,n.uX)(),(0,n.CE)("div",{key:2,class:"reaction-picker",style:(0,N.Tr)(s.reactionPickerStyle)},[(0,n.Lk)("div",Ut,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.availableReactions,(function(e){return(0,n.uX)(),(0,n.CE)("button",{key:e,class:"reaction-btn",onClick:function(t){return s.addReaction(s.showingReactionsFor,e)}},(0,N.v_)(e),9,It)})),128))])],4)):(0,n.Q3)("",!0),s.showDeleteConfirmation?((0,n.uX)(),(0,n.CE)("div",Dt,[(0,n.Lk)("div",Rt,[t[17]||(t[17]=(0,n.Lk)("h3",null,"Confirmer la suppression",-1)),t[18]||(t[18]=(0,n.Lk)("p",null,"Êtes-vous sûr de vouloir supprimer ce message ?",-1)),(0,n.Lk)("div",Mt,[(0,n.Lk)("button",{onClick:t[5]||(t[5]=function(){return s.deleteMessage&&s.deleteMessage.apply(s,arguments)}),class:"delete-confirm-btn"},"Supprimer"),(0,n.Lk)("button",{onClick:t[6]||(t[6]=function(){return s.cancelDeleteConfirmation&&s.cancelDeleteConfirmation.apply(s,arguments)}),class:"delete-cancel-btn"},"Annuler")])])])):(0,n.Q3)("",!0)],544),(0,n.Lk)("div",Kt,[(0,n.Lk)("form",{onSubmit:t[9]||(t[9]=(0,r.D$)((function(){return s.sendMessage&&s.sendMessage.apply(s,arguments)}),["prevent"])),class:"message-form"},[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=function(e){return s.newMessage=e}),type:"text",placeholder:"Écrivez votre message ici...",class:"message-input"},null,512),[[r.Jo,s.newMessage]]),t[19]||(t[19]=(0,n.Lk)("button",{type:"submit",class:"send-button"},"Envoyer",-1))],32)])])):((0,n.uX)(),(0,n.CE)("div",Xt," Chargement de la discussion... "))])):((0,n.uX)(),(0,n.CE)("div",Ft," Sélectionnez une discussion pour voir les messages "))}var _t=a(9258),Vt=a(3772);a(6910),a(1415),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);const St={props:{discussionId:{type:String,default:null}},emits:["hide-discussion"],setup:function(e,t){var a=t.emit,r=(0,fe.KR)(null),s=(0,fe.KR)([]),i=(0,fe.KR)({}),u=(0,fe.KR)({}),o=(0,fe.KR)({}),c=(0,fe.KR)(""),l=(0,fe.KR)(null),d=(0,fe.KR)([]),p=(0,fe.KR)(!0),v=((0,fe.KR)(new Set),(0,fe.KR)(null),(0,fe.KR)(null)),f=(0,fe.KR)(""),m=(0,fe.KR)(null),g=(0,fe.KR)(["👍","❤️","😂","😮","😢","👏","🎉","🤔"]),k=(0,fe.KR)(null),h=(0,fe.KR)({top:0,left:0}),b=(0,fe.KR)(null),x=(0,fe.KR)({top:0,left:0}),w=(0,fe.KR)(null),P=(0,fe.KR)(null),E=(0,fe.KR)(null),U=(0,fe.KR)(!1),I=(0,fe.KR)(null),D=(0,n.EW)((function(){return{top:"".concat(h.value.top,"px"),left:"".concat(h.value.left,"px")}})),R=(0,n.EW)((function(){return{top:"".concat(x.value.top,"px"),left:"".concat(x.value.left,"px")}})),M=function(){a("hide-discussion")},K=function(e){var t=(0,C.xI)(),a=t.currentUser;return a&&a.uid===e},X=function(e){var t=(0,C.xI)(),a=t.currentUser;return a&&a.uid===e.senderId},F=function(e){if(K(e)){var t=(0,C.xI)(),a=t.currentUser;if(a&&a.displayName){var r=a.displayName.split(" ");if(r.length>=2)return(r[0][0]+r[1][0]).toUpperCase();if(1===r.length)return r[0][0].toUpperCase()}return"V"}if(i.value[e]){var n=i.value[e].split(" ");if(n.length>=2)return(n[0][0]+n[1][0]).toUpperCase();if(1===n.length)return n[0][0].toUpperCase()}return"U"},N=function(e){var t;return(null===(t=o.value[e])||void 0===t?void 0:t.isOnline)||!1},_=function(e){if(!e)return"";try{var t=e.toDate?e.toDate():new Date(e),a=new Date,r=t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear(),n={hour:"2-digit",minute:"2-digit"},s={day:"2-digit",month:"2-digit",year:"numeric"};return r?"Aujourd'hui, ".concat(t.toLocaleTimeString(void 0,n)):t.toLocaleDateString(void 0,s)+", "+t.toLocaleTimeString(void 0,n)}catch(i){return console.error("Error formatting date:",i),""}},V=function(){if(l.value){var e=l.value,t=e.scrollTop,a=e.scrollHeight,r=e.clientHeight;p.value=Math.abs(a-r-t)<20,B()}},S=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a=arguments;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],e.next=3,(0,n.dY)();case 3:l.value&&(p.value||t)&&(l.value.scrollTop=l.value.scrollHeight);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){if(l.value&&0!==s.value.length){var e=(0,C.xI)(),t=e.currentUser;if(t){var a=l.value.getBoundingClientRect();if(d.value){var r=Array.isArray(d.value)?d.value:[d.value],n=[];r.forEach((function(e){if(e){var t=e.getBoundingClientRect();if(t.top<a.bottom&&t.bottom>a.top){var r=e.getAttribute("data-message-id");r&&n.push(r)}}})),n.length>0&&n.forEach((function(e){var a=s.value.find((function(t){return t.id===e}));a&&a.senderId!==t.uid&&O(e)}))}}}},O=function(){var t=(0,L.A)((0,y.A)().mark((function t(a){var r,n,i,u,o;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a&&e.discussionId){t.next=2;break}return t.abrupt("return");case 2:if(r=(0,C.xI)(),n=r.currentUser,n){t.next=6;break}return t.abrupt("return");case 6:if(t.prev=6,i=s.value.find((function(e){return e.id===a})),!(!i||i.senderId===n.uid||i.readBy&&i.readBy.includes(n.uid))){t.next=10;break}return t.abrupt("return");case 10:return u=(0,A.aU)(),o=(0,A.H9)(u,"discussions",e.discussionId,"messages",a),t.next=14,(0,A.mZ)(o,(0,Vt.A)({readBy:(0,A.hq)(n.uid)},"lastReadAt.".concat(n.uid),(0,A.O5)()));case 14:i&&!i.readBy?i.readBy=[n.uid]:i&&!i.readBy.includes(n.uid)&&i.readBy.push(n.uid),i.lastReadAt||(i.lastReadAt={}),i.lastReadAt[n.uid]=new Date,t.next=22;break;case 19:t.prev=19,t.t0=t["catch"](6),console.error("Error marking message as read:",t.t0);case 22:case"end":return t.stop()}}),t,null,[[6,19]])})));return function(e){return t.apply(this,arguments)}}(),j=function(e){if(!e.readBy)return"not-read";if(X(e)){var t=z(e);return 0===t?"not-read":t<r.value.participants.length-1?"partially-read":"all-read"}var a=(0,C.xI)(),n=a.currentUser;return n&&e.readBy.includes(n.uid)?"read":"not-read"},z=function(e){return e.readBy&&Array.isArray(e.readBy)?e.readBy.filter((function(t){return t!==e.senderId})).length:0},T=function(e){return e&&e.readBy&&Array.isArray(e.readBy)&&e.lastReadAt?e.readBy.filter((function(t){return t!==e.senderId})).map((function(t){return{userId:t,name:K(t)?"Vous":i.value[t]||"Utilisateur",timestamp:e.lastReadAt[t]}})).sort((function(e,t){if(e.timestamp&&t.timestamp){var a=e.timestamp.toDate?e.timestamp.toDate():new Date(e.timestamp),r=t.timestamp.toDate?t.timestamp.toDate():new Date(t.timestamp);return a-r}return 0})):[]},H=function(e){if(!e||!r.value||!r.value.participants)return[];var t=new Set(e.readBy||[]);return r.value.participants.filter((function(a){return a!==e.senderId&&!t.has(a)})).map((function(e){return K(e)?"Vous":i.value[e]||"Utilisateur"}))},J=function(e){b.value=e,(0,n.dY)((function(){var t=document.querySelector('[data-message-id="'.concat(e.id,'"]'));if(t&&l.value){var a=t.getBoundingClientRect(),r=l.value.getBoundingClientRect();x.value={top:a.bottom-r.top+5,left:a.right-r.left-150}}}))},Q=function(){b.value=null},W=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r,n,s,i,u,o,c,l,d,p,v,f,m;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,a=(0,C.xI)(),r=a.currentUser,!r||r.uid!==t){e.next=15;break}return n=r.photoURL,s=r.displayName||"",i=(0,A.aU)(),u=(0,A.H9)(i,"users",t),e.next=10,(0,A.x7)(u);case 10:return o=e.sent,o.exists()&&(c=o.data(),s||(s="".concat(c.firstName||""," ").concat(c.lastName||"").trim()),c.profileImageUrl&&(n=c.profileImageUrl)),e.abrupt("return",{fullName:s,profilePicture:n});case 15:return l=(0,A.aU)(),d=(0,A.H9)(l,"users",t),e.next=19,(0,A.x7)(d);case 19:if(p=e.sent,!p.exists()){e.next=25;break}return v=p.data(),f="".concat(v.firstName||""," ").concat(v.lastName||"").trim(),m=v.profileImageUrl||null,e.abrupt("return",{fullName:f,profilePicture:m});case 25:return e.abrupt("return",{fullName:null,profilePicture:null});case 28:return e.prev=28,e.t0=e["catch"](0),console.error("Error fetching user info for ".concat(t,":"),e.t0),e.abrupt("return",{fullName:null,profilePicture:null});case 32:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t){return e.apply(this,arguments)}}(),G=function(e){var t=(0,C.xI)(),a=t.currentUser;return a&&a.uid===e?"Vous":i.value[e]?i.value[e]:(W(e).then((function(t){t.fullName?i.value[e]=t.fullName:i.value[e]=e,t.profilePicture&&(u.value[e]=t.profilePicture)}))["catch"]((function(){i.value[e]=e})),i.value[e]||"Chargement...")},q=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r,n,s,o,c,l,d;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=(0,_t.A)(new Set(t)),r=(0,pe.A)(a),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}return s=n.value,e.next=8,W(s);case 8:o=e.sent,o.fullName?i.value[s]=o.fullName:i.value[s]=s,o.profilePicture&&(u.value[s]=o.profilePicture);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](2),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:if(c=(0,C.xI)(),l=c.currentUser,!l){e.next=28;break}return e.next=26,W(l.uid);case 26:d=e.sent,d.profilePicture?u.value[l.uid]=d.profilePicture:l.photoURL&&(u.value[l.uid]=l.photoURL);case 28:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=(0,C.xI)(),r=a.currentUser,r&&r.uid===t.senderId){e.next=4;break}return e.abrupt("return");case 4:return v.value=t.id,f.value=t.content,e.next=8,(0,n.dY)();case 8:m.value&&(Array.isArray(m.value)?m.value[0]&&m.value[0].focus():m.value.focus());case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var t=(0,L.A)((0,y.A)().mark((function t(a){var r,n,s,i;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(f.value.trim()){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,r=(0,C.xI)(),n=r.currentUser,n){t.next=8;break}return alert("Vous devez être connecté pour modifier un message"),t.abrupt("return");case 8:return s=(0,A.aU)(),i=(0,A.H9)(s,"discussions",e.discussionId,"messages",a),t.next=12,(0,A.mZ)(i,{content:f.value.trim(),edited:!0,editedAt:(0,A.O5)()});case 12:v.value=null,f.value="",t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](2),console.error("Erreur lors de la modification du message:",t.t0),alert("Une erreur s'est produite lors de la modification du message");case 20:case"end":return t.stop()}}),t,null,[[2,16]])})));return function(e){return t.apply(this,arguments)}}(),$=function(){v.value=null,f.value=""},ee=function(e){I.value=e,U.value=!0},te=function(){I.value=null,U.value=!1},ae=function(){var t=(0,L.A)((0,y.A)().mark((function t(){var a,r,n,i,u,o,c;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(I.value){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,a=(0,C.xI)(),r=a.currentUser,r){t.next=8;break}return alert("Vous devez être connecté pour supprimer un message"),t.abrupt("return");case 8:if(n=s.value.find((function(e){return e.id===I.value})),n&&n.senderId===r.uid){t.next=13;break}return alert("Vous ne pouvez supprimer que vos propres messages"),te(),t.abrupt("return");case 13:return i=(0,A.aU)(),u=(0,A.H9)(i,"discussions",e.discussionId,"messages",I.value),t.next=17,(0,A.kd)(u);case 17:if(o=s.value[s.value.length-1],!o||o.id!==I.value){t.next=27;break}if(c=s.value[s.value.length-2],!c){t.next=25;break}return t.next=23,(0,A.mZ)((0,A.H9)(i,"discussions",e.discussionId),{lastActivity:c.createdAt,lastMessageSenderId:c.senderId,lastMessageText:c.content.substring(0,100)});case 23:t.next=27;break;case 25:return t.next=27,(0,A.mZ)((0,A.H9)(i,"discussions",e.discussionId),{lastActivity:(0,A.O5)(),lastMessageSenderId:null,lastMessageText:null});case 27:te(),t.next=35;break;case 30:t.prev=30,t.t0=t["catch"](2),console.error("Erreur lors de la suppression du message:",t.t0),alert("Une erreur s'est produite lors de la suppression du message"),te();case 35:case"end":return t.stop()}}),t,null,[[2,30]])})));return function(){return t.apply(this,arguments)}}(),re=function(e){k.value=e,(0,n.dY)((function(){var t=document.querySelector('[data-message-id="'.concat(e,'"]'));if(t&&l.value){var a=t.getBoundingClientRect(),r=l.value.getBoundingClientRect();h.value={top:a.bottom-r.top+5,left:a.left-r.left}}}))},ne=function(){var t=(0,L.A)((0,y.A)().mark((function t(a,r){var n,i,u,o,c,l,d;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=(0,C.xI)(),i=n.currentUser,i){t.next=5;break}return alert("Vous devez être connecté pour réagir à un message"),t.abrupt("return");case 5:if(t.prev=5,u=(0,A.aU)(),o=(0,A.H9)(u,"discussions",e.discussionId,"messages",a),c=s.value.find((function(e){return e.id===a})),l=ie(c,r),!l){t.next=20;break}return t.next=13,(0,A.mZ)(o,(0,Vt.A)({},"reactions.".concat(r,".").concat(i.uid),(0,A.CL)()));case 13:if(!(c&&c.reactions&&c.reactions[r])){t.next=18;break}if(d=Object.keys(c.reactions[r]).filter((function(e){return e!==i.uid})),0!==d.length){t.next=18;break}return t.next=18,(0,A.mZ)(o,(0,Vt.A)({},"reactions.".concat(r),(0,A.CL)()));case 18:t.next=22;break;case 20:return t.next=22,(0,A.mZ)(o,(0,Vt.A)({},"reactions.".concat(r,".").concat(i.uid),(0,A.O5)()));case 22:k.value=null,t.next=28;break;case 25:t.prev=25,t.t0=t["catch"](5),console.error("Erreur lors de l'ajout d'une réaction:",t.t0);case 28:case"end":return t.stop()}}),t,null,[[5,25]])})));return function(e,a){return t.apply(this,arguments)}}(),se=function(e,t){ne(e,t)},ie=function(e,t){var a=(0,C.xI)(),r=a.currentUser;return!!(r&&e&&e.reactions&&e.reactions[t])&&!!e.reactions[t][r.uid]},ue=function(){var t=(0,L.A)((0,y.A)().mark((function t(){var a,r,n;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(c.value.trim()){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,a=(0,C.xI)(),r=a.currentUser,r){t.next=8;break}return alert("Vous devez être connecté pour envoyer un message"),t.abrupt("return");case 8:return n=(0,A.aU)(),t.next=11,(0,A.gS)((0,A.rJ)(n,"discussions",e.discussionId,"messages"),{content:c.value.trim(),senderId:r.uid,createdAt:(0,A.O5)(),readBy:[r.uid],lastReadAt:(0,Vt.A)({},r.uid,(0,A.O5)())});case 11:return t.sent,t.next=14,(0,A.mZ)((0,A.H9)(n,"discussions",e.discussionId),{lastActivity:(0,A.O5)(),lastMessageSenderId:r.uid,lastMessageText:c.value.trim().substring(0,100)});case 14:c.value="",S(!0),t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](2),console.error("Erreur lors de l'envoi du message:",t.t0),alert("Une erreur s'est produite lors de l'envoi du message");case 22:case"end":return t.stop()}}),t,null,[[2,18]])})));return function(){return t.apply(this,arguments)}}(),oe=function(){var t=(0,L.A)((0,y.A)().mark((function t(){var a,r,n,s;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=(0,C.xI)(),r=a.currentUser,r&&e.discussionId){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,n=(0,A.aU)(),s=(0,A.H9)(n,"presence",r.uid),t.next=9,(0,A.BN)(s,{userId:r.uid,online:!0,lastActive:(0,A.O5)(),currentDiscussion:e.discussionId},{merge:!0});case 9:t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),console.error("Error updating presence:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[4,11]])})));return function(){return t.apply(this,arguments)}}(),ce=function(){if(r.value&&r.value.participants){var t=(0,A.aU)(),a=(0,C.xI)(),n=a.currentUser;w.value&&(w.value(),w.value=null);var s=r.value.participants.map((function(e){var a=(0,A.H9)(t,"presence",e);return(0,A.aQ)(a,(function(t){if(t.exists()){var a=t.data();o.value[e]={isOnline:a.online||!1,lastActive:a.lastActive,currentDiscussion:a.currentDiscussion}}else o.value[e]={isOnline:!1,lastActive:null,currentDiscussion:null}}),(function(t){console.error("Error listening to presence for ".concat(e,":"),t)}))}));w.value=function(){s.forEach((function(e){return e()}))},n&&(o.value[n.uid]={isOnline:!0,lastActive:new Date,currentDiscussion:e.discussionId})}},le=function(){var t=(0,L.A)((0,y.A)().mark((function t(){var a,n;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.discussionId){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,a=(0,A.aU)(),t.next=6,(0,A.x7)((0,A.H9)(a,"discussions",e.discussionId));case 6:if(n=t.sent,!n.exists()){t.next=16;break}if(r.value=(0,ve.A)({id:n.id},n.data()),!(r.value.participants&&r.value.participants.length>0)){t.next=12;break}return t.next=12,q(r.value.participants);case 12:ce(),de(),t.next=18;break;case 16:console.error("Discussion not found"),r.value=null;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](2),console.error("Error loading discussion:",t.t0),r.value=null;case 24:case"end":return t.stop()}}),t,null,[[2,20]])})));return function(){return t.apply(this,arguments)}}(),de=function(){if(e.discussionId){E.value&&(E.value(),E.value=null);var t=(0,A.aU)(),a=(0,A.P)((0,A.rJ)(t,"discussions",e.discussionId,"messages"),(0,A.My)("createdAt","asc"));E.value=(0,A.aQ)(a,(function(e){if(e.empty)s.value=[];else{var t=[],a=new Set;e.forEach((function(e){var r=(0,ve.A)({id:e.id},e.data());t.push(r),r.senderId&&a.add(r.senderId)})),s.value=t,q((0,_t.A)(a)),S(),setTimeout((function(){B()}),1e3)}}),(function(e){console.error("Error loading messages:",e)}))}};return(0,n.wB)((function(){return e.discussionId}),(function(e,t){e&&e!==t?(r.value=null,s.value=[],le()):e||(r.value=null,s.value=[])}),{immediate:!0}),(0,n.sV)((function(){oe(),P.value=setInterval((function(){oe()}),6e4)})),(0,n.hi)((function(){P.value&&(clearInterval(P.value),P.value=null),w.value&&(w.value(),w.value=null),E.value&&(E.value(),E.value=null);var e=(0,C.xI)(),t=e.currentUser;if(t)try{var a=(0,A.aU)(),r=(0,A.H9)(a,"presence",t.uid);(0,A.BN)(r,{online:!1,lastActive:(0,A.O5)(),currentDiscussion:null},{merge:!0})}catch(n){console.error("Error updating offline status:",n)}})),{discussion:r,responses:s,userNames:i,userAvatars:u,userStatuses:o,newMessage:c,messagesContainer:l,messageElements:d,isScrolledToBottom:p,editingMessageId:v,editMessageContent:f,editTextarea:m,availableReactions:g,showingReactionsFor:k,reactionPickerStyle:D,showingReadReceiptsFor:b,readReceiptsTooltipStyle:R,showDeleteConfirmation:U,Hide:M,handleScroll:V,sendMessage:ue,formatDate:_,isCurrentUser:K,isCurrentUserMessage:X,getUserInitials:F,startEditMessage:Z,saveMessageEdit:Y,cancelMessageEdit:$,confirmDeleteMessage:ee,cancelDeleteConfirmation:te,deleteMessage:ae,showReactionPicker:re,addReaction:ne,toggleReaction:se,hasUserReacted:ie,getReadStatusClass:j,getReadCount:z,getReadUsersList:T,getUnreadUsersList:H,showReadReceipts:J,hideReadReceipts:Q,getUserDisplayName:G,isUserOnline:N}}},Bt=(0,u.A)(St,[["render",Nt],["__scopeId","data-v-5ea10e8d"]]),Ot=Bt,jt={name:"Forum",components:{SingleDisc:Fe,Responses:Ot},emits:["select-discussion"],setup:function(e,t){var a=t.emit,r=(0,l.rd)(),s=(0,fe.KR)(null),i=(0,fe.KR)(null),u=(0,fe.KR)(""),o=(0,fe.KR)(""),c=(0,fe.KR)(!1),d=(0,fe.KR)(""),p=(0,fe.KR)([]),v=(0,fe.KR)(!0),f=(0,fe.KR)(null),m=(0,fe.KR)("all"),g=(0,fe.KR)(null),k=(0,fe.KR)(!1),h=(0,fe.KR)(!1),b=(0,fe.KR)(""),x=(0,fe.KR)(!1),w=(0,fe.KR)(""),P=(0,fe.KR)(""),E=(0,fe.KR)(""),U=(0,fe.KR)(!1),I=(0,fe.KR)(""),D=(0,fe.KR)(""),R=(0,fe.KR)(""),M=(0,fe.KR)(""),K=(0,fe.KR)([]),X=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a=(0,A.aU)(),e.next=4,(0,A.x7)((0,A.H9)(a,"users",t));case 4:r=e.sent,r.exists()&&(u.value=r.data().FirstName||"",o.value=r.data().LastName||"",c.value=r.data().isOnline||!1,d.value=r.data().profileImageUrl||""),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error("Error fetching user data:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),F=function(){s.value?(b.value=d.value||"",h.value=!0):alert("Vous devez être connecté pour modifier votre photo de profil.")},N=function(){h.value=!1,b.value=""},_=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s.value){e.next=3;break}return alert("Vous devez être connecté pour modifier votre photo de profil."),e.abrupt("return");case 3:return e.prev=3,t=(0,A.aU)(),e.next=7,(0,A.mZ)((0,A.H9)(t,"users",user.uid),{profileImageUrl:b.value});case 7:d.value=b.value,N(),alert("Photo de profil mise à jour avec succès!"),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](3),console.error("Error updating profile picture:",e.t0),alert("Erreur lors de la mise à jour de la photo de profil.");case 16:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t=(0,C.xI)(),a=(0,A.aU)(),!s.value){e.next=6;break}return e.next=6,(0,A.mZ)((0,A.H9)(a,"users",s.value),{isOnline:!1});case 6:return e.next=8,(0,C.CI)(t);case 8:r.push("/"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),console.error("Error logging out:",e.t0),alert("Une erreur s'est produite lors de la déconnexion");case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,r,n,s,i;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,v.value=!0,t=(0,A.aU)(),a=(0,A.P)((0,A.rJ)(t,"discussions"),(0,A.My)("createdAt","desc")),e.next=6,(0,A.GG)(a);case 6:return r=e.sent,n=(0,A.rJ)(t,"users"),e.next=10,(0,A.GG)(n);case 10:return s=e.sent,i={},s.forEach((function(e){i[e.id]=e.data()})),e.next=15,Promise.all(r.docs.map(function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.data(),a.createdAt&&(a.createdAtTimestamp=a.createdAt.toDate?a.createdAt.toDate().getTime():new Date(a.createdAt).getTime()),a.participants||(a.participants=[]),a.createdBy&&i[a.createdBy]&&(a.creatorPic=i[a.createdBy].profileImageUrl||""),e.abrupt("return",(0,ve.A)({id:t.id},a));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:p.value=e.sent,console.log("Fetched discussions:",p.value),e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](0),console.error("Failed to load discussions:",e.t0),f.value="Failed to load discussions: "+e.t0.message;case 23:return e.prev=23,v.value=!1,e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[0,19,23,26]])})));return function(){return e.apply(this,arguments)}}(),B=function(e){return s.value&&e.participants&&Array.isArray(e.participants)&&e.participants.includes(s.value)},O=(0,n.EW)((function(){if(!p.value.length)return[];var e=p.value.filter((function(e){return!0!==e.isPrivate||B(e)}));return"all"===m.value?e:"private"===m.value?e.filter((function(e){return!0===e.isPrivate})):"public"===m.value?e.filter((function(e){return!1===e.isPrivate})):e})),j=function(){if(g.value&&s.value){var e=p.value.find((function(e){return e.id===g.value}));k.value=!!e&&B(e)}else k.value=!1},z=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r,n,i;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s.value){e.next=3;break}return alert("Vous devez être connecté pour rejoindre une discussion"),e.abrupt("return");case 3:return e.prev=3,a=(0,A.aU)(),r=(0,A.H9)(a,"discussions",t),e.next=8,(0,A.x7)(r);case 8:if(n=e.sent,n.exists()){e.next=11;break}throw new Error("Discussion not found");case 11:return e.next=13,(0,A.mZ)(r,{participants:(0,A.hq)(s.value)});case 13:i=p.value.findIndex((function(e){return e.id===t})),-1!==i&&(p.value[i].participants||(p.value[i].participants=[]),p.value[i].participants.includes(s.value)||p.value[i].participants.push(s.value)),k.value=!0,console.log("Successfully joined discussion ".concat(t)),e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](3),console.error("Error joining discussion:",e.t0),alert("Une erreur s'est produite lors de la tentative de rejoindre la discussion");case 23:case"end":return e.stop()}}),e,null,[[3,19]])})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=(0,L.A)((0,y.A)().mark((function e(t,a){var r,n,i,u;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s.value){e.next=3;break}return alert("Vous devez être connecté pour quitter une discussion"),e.abrupt("return");case 3:return e.prev=3,r=(0,A.aU)(),n=(0,A.H9)(r,"discussions",t),e.next=8,(0,A.x7)(n);case 8:if(i=e.sent,i.exists()){e.next=11;break}throw new Error("Discussion not found");case 11:return e.next=13,(0,A.mZ)(n,{participants:(0,A.C3)(s.value)});case 13:if(u=p.value.findIndex((function(e){return e.id===t})),-1!==u&&p.value[u].participants&&(p.value[u].participants=p.value[u].participants.filter((function(e){return e!==s.value}))),g.value===t&&G(),!a){e.next=19;break}return e.next=19,S();case 19:console.log("Successfully left discussion ".concat(t)),e.next=26;break;case 22:e.prev=22,e.t0=e["catch"](3),console.error("Error leaving discussion:",e.t0),alert("Une erreur s'est produite lors de la tentative de quitter la discussion");case 26:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t,a){return e.apply(this,arguments)}}(),H=function(){m.value="all"},J=function(){m.value="private"},Q=function(){m.value="public"},W=function(e){g.value=e,a("select-discussion",e),j()},G=function(){g.value=null,k.value=!1},q=function(){s.value?(x.value=!0,U.value=!1,h.value=!1):alert("Vous devez être connecté pour créer une discussion.")},Z=function(){s.value?(U.value=!0,x.value=!1,h.value=!1):alert("Vous devez être connecté pour créer une discussion.")},Y=function(){x.value=!1,U.value=!1,w.value="",P.value="",E.value="",I.value="",D.value="",R.value="",M.value="",K.value=[]},$=function(){M.value&&!K.value.includes(M.value)&&(K.value.push(M.value),M.value="")},ee=function(e){K.value.splice(e,1)},te=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,r,n,i,u,o,c,l,v,f,m,g,k,h;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s.value){e.next=3;break}return alert("Vous devez être connecté pour créer une discussion."),e.abrupt("return");case 3:if(w.value.trim()){e.next=6;break}return alert("Le titre de la discussion est obligatoire."),e.abrupt("return");case 6:if(t=E.value.trim(),t){e.next=10;break}return alert("Veuillez spécifier un participant."),e.abrupt("return");case 10:e.prev=10,a=(0,A.aU)(),r=(0,A.rJ)(a,"users"),n=["Email","email","userEmail"],i=null,u=0,o=n;case 16:if(!(u<o.length)){e.next=39;break}if(c=o[u],!i){e.next=20;break}return e.abrupt("break",39);case 20:return l=(0,A.P)(r,(0,A._M)(c,"==",t)),e.next=23,(0,A.GG)(l);case 23:if(v=e.sent,v.empty){e.next=28;break}return v.forEach((function(e){i=e.id})),console.log("Found user with ".concat(c," (case-sensitive): ").concat(i)),e.abrupt("break",39);case 28:return f=(0,A.P)(r,(0,A._M)(c,"==",t.toLowerCase())),e.next=31,(0,A.GG)(f);case 31:if(m=e.sent,m.empty){e.next=36;break}return m.forEach((function(e){i=e.id})),console.log("Found user with ".concat(c," (lowercase): ").concat(i)),e.abrupt("break",39);case 36:u++,e.next=16;break;case 39:if(i){e.next=45;break}return console.log("User not found with direct queries, trying manual comparison"),e.next=43,(0,A.GG)(r);case 43:g=e.sent,g.forEach((function(e){var a=e.data();for(var r in a)if("string"===typeof a[r]&&a[r].toLowerCase()===t.toLowerCase()&&a[r].includes("@")){i=e.id,console.log("Found user by manual search in field ".concat(r,": ").concat(i));break}}));case 45:if(i){e.next=48;break}return alert("Utilisateur non trouvé avec cet email. Vérifiez l'adresse email et réessayez."),e.abrupt("return");case 48:return k={title:w.value.trim(),description:P.value.trim(),isPrivate:!0,participants:[s.value,i],createdAt:(0,A.O5)(),createdBy:s.value,creatorPic:d.value||""},e.next=51,(0,A.gS)((0,A.rJ)(a,"discussions"),k);case 51:h=e.sent,p.value.unshift((0,ve.A)((0,ve.A)({id:h.id},k),{},{createdAt:new Date})),alert("Discussion privée créée avec succès!"),Y(),e.next=61;break;case 57:e.prev=57,e.t0=e["catch"](10),console.error("Erreur lors de la création de la discussion privée:",e.t0),alert("Erreur lors de la création de la discussion. Veuillez réessayer.");case 61:case"end":return e.stop()}}),e,null,[[10,57]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,r,n,i,u,o,c,l;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s.value){e.next=3;break}return alert("Vous devez être connecté pour créer une discussion."),e.abrupt("return");case 3:if(I.value.trim()){e.next=6;break}return alert("Le titre de la discussion est obligatoire."),e.abrupt("return");case 6:if(e.prev=6,t=(0,A.aU)(),a=[s.value],r=[],!(K.value.length>0)){e.next=28;break}n=(0,A.rJ)(t,"users"),i=(0,pe.A)(K.value),e.prev=13,o=(0,y.A)().mark((function e(){var t,s,i,o,c,l,d,p,v,f,m,g;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=u.value,s=t.trim(),i=!1,o=["Email","email","userEmail"],c=0,l=o;case 5:if(!(c<l.length)){e.next=23;break}if(d=l[c],!i){e.next=9;break}return e.abrupt("break",23);case 9:return p=(0,A.P)(n,(0,A._M)(d,"==",s)),e.next=12,(0,A.GG)(p);case 12:if(v=e.sent,v.empty||v.forEach((function(e){a.includes(e.id)||(a.push(e.id),i=!0)})),i){e.next=20;break}return f=(0,A.P)(n,(0,A._M)(d,"==",s.toLowerCase())),e.next=18,(0,A.GG)(f);case 18:m=e.sent,m.empty||m.forEach((function(e){a.includes(e.id)||(a.push(e.id),i=!0)}));case 20:c++,e.next=5;break;case 23:if(i){e.next=28;break}return e.next=26,(0,A.GG)(n);case 26:g=e.sent,g.forEach((function(e){var t=e.data();for(var r in t)if("string"===typeof t[r]&&t[r].toLowerCase()===s.toLowerCase()&&t[r].includes("@")&&!a.includes(e.id)){a.push(e.id),i=!0;break}}));case 28:i||r.push(s);case 29:case"end":return e.stop()}}),e)})),i.s();case 16:if((u=i.n()).done){e.next=20;break}return e.delegateYield(o(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e["catch"](13),i.e(e.t1);case 25:return e.prev=25,i.f(),e.finish(25);case 28:return r.length>0&&alert("Attention: Les adresses emails suivantes n'ont pas été trouvées: ".concat(r.join(", "))),c={title:I.value.trim(),description:D.value.trim(),isPrivate:!1,participants:a,createdAt:(0,A.O5)(),createdBy:s.value,creatorPic:d.value||"",profileImageUrl:R.value||""},e.next=32,(0,A.gS)((0,A.rJ)(t,"discussions"),c);case 32:l=e.sent,p.value.unshift((0,ve.A)((0,ve.A)({id:l.id},c),{},{createdAt:new Date})),alert("Discussion publique créée avec succès!"),Y(),e.next=42;break;case 38:e.prev=38,e.t2=e["catch"](6),console.error("Erreur lors de la création de la discussion publique:",e.t2),alert("Erreur lors de la création de la discussion. Veuillez réessayer.");case 42:case"end":return e.stop()}}),e,null,[[6,38],[13,22,25,28]])})));return function(){return e.apply(this,arguments)}}();return(0,n.sV)((0,L.A)((0,y.A)().mark((function e(){var t;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=(0,C.xI)(),(0,C.hg)(t,function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=10;break}return s.value=t.uid,i.value=t.email,a=(0,A.aU)(),e.next=6,(0,A.mZ)((0,A.H9)(a,"users",t.uid),{isOnline:!0});case 6:return e.next=8,X(t.uid);case 8:e.next=16;break;case 10:s.value=null,i.value=null,u.value="",o.value="",c.value=!1,d.value="";case 16:j();case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,S();case 4:case"end":return e.stop()}}),e)})))),{userId:s,userEmail:i,FirstName:u,LastName:o,isOnline:c,profileImageUrl:d,discussions:p,loading:v,error:f,filteredDiscussions:O,logout:V,showAll:H,showPrivate:J,showPublic:Q,handleViewDiscussion:W,hideDiscussion:G,currentDiscussionId:g,canViewDiscussion:k,isParticipant:B,joinDiscussion:z,leaveDiscussion:T,filterType:m,showProfilePicDialog:h,profilePicInput:b,openProfilePicDialog:F,closeProfilePicDialog:N,updateProfilePicture:_,showPrivateDialog:x,newDiscPrivateTitle:w,newDiscPrivateDescription:P,newDiscParticipantEmail:E,openCreatePrivateDialog:q,createPrivateDiscussion:te,showPublicDialog:U,newDiscPublicTitle:I,newDiscPublicDescription:D,newDiscPublicImageUrl:R,newParticipantEmail:M,participantEmails:K,openCreatePublicDialog:Z,createPublicDiscussion:ae,addParticipantEmail:$,removeParticipantEmail:ee,closeModals:Y}}},zt=(0,u.A)(jt,[["render",de],["__scopeId","data-v-0acf6597"]]),Tt=zt;var Ht={class:"profile-container"},Jt={class:"profile-header"},Qt={class:"status-indicator"},Wt={class:"profile-form"},Gt={class:"profile-picture-section"},qt={class:"profile-picture-container"},Zt=["src"],Yt={key:0,class:"upload-overlay"},$t={class:"upload-progress"},ea={class:"profile-picture-actions"},ta={class:"image-url-form"},aa=["disabled"],ra=["disabled"],na={class:"form-group"},sa=["placeholder"],ia={class:"form-group"},ua=["placeholder"],oa={class:"form-group"},ca={class:"form-group"},la={class:"form-group"},da=["placeholder"],pa={class:"form-actions"},va=["disabled"],fa={key:0,class:"success-message"},ma={key:1,class:"error-message"},ga={class:"navigation-links"};function ka(e,t,a,s,i,u){var o=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Ht,[(0,n.Lk)("div",Jt,[t[12]||(t[12]=(0,n.Lk)("h2",null,"Profile Page",-1)),(0,n.Lk)("div",Qt,[t[11]||(t[11]=(0,n.Lk)("span",{class:"status-label"},"Status:",-1)),(0,n.Lk)("span",{class:(0,N.C4)(["status-value",{online:s.isOnline}])},(0,N.v_)(s.isOnline?"Online":"Offline"),3)])]),(0,n.Lk)("div",Wt,[(0,n.Lk)("div",Gt,[(0,n.Lk)("div",qt,[(0,n.Lk)("img",{src:s.profileImageUrl||"/default-avatar.png",alt:"Profile Picture",class:"profile-picture",onError:t[0]||(t[0]=function(){return s.handleImageError&&s.handleImageError.apply(s,arguments)})},null,40,Zt),s.isUploading?((0,n.uX)(),(0,n.CE)("div",Yt,[(0,n.Lk)("div",$t,(0,N.v_)(s.uploadProgress)+"%",1)])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",ea,[(0,n.Lk)("div",ta,[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=function(e){return s.imageUrlInput=e}),placeholder:"Enter image URL",class:"image-url-input"},null,512),[[r.Jo,s.imageUrlInput]]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=function(){return s.setImageFromUrl&&s.setImageFromUrl.apply(s,arguments)}),class:"url-button",disabled:s.isUploading||!s.imageUrlInput}," Set Image ",8,aa)]),t[13]||(t[13]=(0,n.Lk)("div",{class:"or-divider"},"- OR -",-1)),t[14]||(t[14]=(0,n.Lk)("label",{for:"profilePicture",class:"upload-button"},[(0,n.Lk)("span",{class:"upload-icon"},"📷"),(0,n.eW)(" Choose Photo ")],-1)),(0,n.Lk)("input",{id:"profilePicture",type:"file",accept:"image/*",onChange:t[3]||(t[3]=function(){return s.handleImageUpload&&s.handleImageUpload.apply(s,arguments)}),class:"file-input"},null,32),s.profileImageUrl?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:t[4]||(t[4]=function(){return s.removeProfilePicture&&s.removeProfilePicture.apply(s,arguments)}),class:"remove-button",disabled:s.isUploading}," Remove Photo ",8,ra)):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",na,[t[15]||(t[15]=(0,n.Lk)("label",{for:"firstName"},"First Name",-1)),(0,n.bo)((0,n.Lk)("input",{id:"firstName",type:"text","onUpdate:modelValue":t[5]||(t[5]=function(e){return s.FirstName=e}),placeholder:s.FirstName||"Enter your first name",required:""},null,8,sa),[[r.Jo,s.FirstName]])]),(0,n.Lk)("div",ia,[t[16]||(t[16]=(0,n.Lk)("label",{for:"lastName"},"Last Name",-1)),(0,n.bo)((0,n.Lk)("input",{id:"lastName",type:"text","onUpdate:modelValue":t[6]||(t[6]=function(e){return s.LastName=e}),placeholder:s.LastName||"Enter your last name",required:""},null,8,ua),[[r.Jo,s.LastName]])]),(0,n.Lk)("div",oa,[t[17]||(t[17]=(0,n.Lk)("label",{for:"currentPassword"},"Current Password",-1)),(0,n.bo)((0,n.Lk)("input",{id:"currentPassword",type:"password","onUpdate:modelValue":t[7]||(t[7]=function(e){return s.oldPass=e}),placeholder:"Enter current password"},null,512),[[r.Jo,s.oldPass]])]),(0,n.Lk)("div",ca,[t[18]||(t[18]=(0,n.Lk)("label",{for:"newPassword"},"New Password",-1)),(0,n.bo)((0,n.Lk)("input",{id:"newPassword",type:"password","onUpdate:modelValue":t[8]||(t[8]=function(e){return s.newPass=e}),placeholder:"Enter new password"},null,512),[[r.Jo,s.newPass]])]),(0,n.Lk)("div",la,[t[19]||(t[19]=(0,n.Lk)("label",{for:"newEmail"},"Email",-1)),t[20]||(t[20]=(0,n.Lk)("p",{class:"email-help"},"Type new email here if you want to change yours",-1)),(0,n.bo)((0,n.Lk)("input",{id:"newEmail",type:"email","onUpdate:modelValue":t[9]||(t[9]=function(e){return s.newEmail=e}),placeholder:s.Email},null,8,da),[[r.Jo,s.newEmail]])]),(0,n.Lk)("div",pa,[(0,n.Lk)("button",{onClick:t[10]||(t[10]=function(){return s.updateProfile&&s.updateProfile.apply(s,arguments)}),class:"save-button",disabled:s.isUploading},"Save Changes",8,va)]),s.successMessage?((0,n.uX)(),(0,n.CE)("div",fa,(0,N.v_)(s.successMessage),1)):(0,n.Q3)("",!0),s.errorMessage?((0,n.uX)(),(0,n.CE)("div",ma,(0,N.v_)(s.errorMessage),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",ga,[(0,n.bF)(o,{to:"/forum/".concat(s.userId),class:"back-link"},{default:(0,n.k6)((function(){return t[21]||(t[21]=[(0,n.Lk)("span",{class:"back-icon"},"←",-1),(0,n.eW)(" Return to Discussions ")])})),_:1},8,["to"])])])}a(9089),a(7495),a(906),a(1392),a(3296),a(7208),a(8408),a(4603),a(7566),a(8721);var ha=a(7844);const ba={name:"ProfilePage",setup:function(){var e=(0,l.lq)(),t=(0,fe.KR)(""),a=(0,fe.KR)(""),r=(0,fe.KR)(""),s=(0,fe.KR)(""),i=(0,fe.KR)(""),u=(0,fe.KR)(null),o=(0,fe.KR)(""),c=(0,fe.KR)(""),d=(0,fe.KR)(""),p=(0,fe.KR)(!1),v=(0,fe.KR)(!1),f=(0,fe.KR)(""),m=(0,fe.KR)(!1),g=(0,fe.KR)(0),k=(0,fe.KR)(""),h=(0,fe.KR)(""),b=(0,fe.KR)(!1),x=function(){var r=(0,L.A)((0,y.A)().mark((function r(){var n,s,i,o,l;return(0,y.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,n=(0,C.xI)(),s=n.currentUser,u.value=(null===s||void 0===s?void 0:s.uid)||e.params.userid,u.value){r.next=7;break}return c.value="No user ID found. Please log in.",r.abrupt("return");case 7:return i=(0,A.aU)(),r.next=10,(0,A.x7)((0,A.H9)(i,"users",u.value));case 10:if(o=r.sent,!o.exists()){r.next=21;break}l=o.data(),t.value=l.FirstName||"",a.value=l.LastName||"",d.value=l.Email||(null===s||void 0===s?void 0:s.email)||"",v.value=l.isOnline||!1,l.profileImageUrl&&(f.value=l.profileImageUrl,k.value=l.profileImagePath||""),p.value=(null===s||void 0===s?void 0:s.emailVerified)||!1,r.next=25;break;case 21:if(!s){r.next=25;break}return r.next=24,(0,A.BN)((0,A.H9)(i,"users",u.value),{FirstName:"",LastName:"",Email:s.email,isOnline:!0,profileImageUrl:"",profileImagePath:"",createdAt:new Date});case 24:d.value=s.email;case 25:r.next=31;break;case 27:r.prev=27,r.t0=r["catch"](0),console.error("Error fetching user data:",r.t0),c.value="Failed to fetch user data: "+r.t0.message;case 31:case"end":return r.stop()}}),r,null,[[0,27]])})));return function(){return r.apply(this,arguments)}}(),w=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,r,n,s;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(h.value){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,o.value="",c.value="",m.value=!0,t=(0,C.xI)(),a=t.currentUser,a){e.next=12;break}return c.value="You must be logged in to update your profile",m.value=!1,e.abrupt("return");case 12:e.prev=12,new URL(h.value),e.next=21;break;case 16:return e.prev=16,e.t0=e["catch"](12),c.value="Please enter a valid URL",m.value=!1,e.abrupt("return");case 21:if(!k.value||!k.value.startsWith("profile_pictures/")){e.next=32;break}return e.prev=22,r=(0,ha.c7)(),n=(0,ha.KR)(r,k.value),e.next=27,(0,ha.XR)(n);case 27:e.next=32;break;case 29:e.prev=29,e.t1=e["catch"](22),console.error("Failed to delete old image:",e.t1);case 32:return e.prev=32,e.next=35,(0,C.r7)(a,{photoURL:h.value});case 35:e.next=40;break;case 37:e.prev=37,e.t2=e["catch"](32),console.error("Failed to update auth profile:",e.t2);case 40:return s=(0,A.aU)(),e.next=43,(0,A.mZ)((0,A.H9)(s,"users",u.value),{profileImageUrl:h.value,profileImagePath:"external_url",updatedAt:new Date});case 43:f.value=h.value,k.value="external_url",o.value="Profile picture updated successfully!",h.value="",e.next=53;break;case 49:e.prev=49,e.t3=e["catch"](2),console.error("Set image URL error:",e.t3),c.value="Failed to set profile picture: "+e.t3.message;case 53:return e.prev=53,m.value=!1,e.finish(53);case 56:case"end":return e.stop()}}),e,null,[[2,49,53,56],[12,16],[22,29],[32,37]])})));return function(){return e.apply(this,arguments)}}(),P=function(e){f.value&&(c.value="Failed to load image. The URL may be invalid or inaccessible.",b.value=!0)},E=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r,n,s,i,l,d,p,v,h,b,x;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.target.files[0],a){e.next=3;break}return e.abrupt("return");case 3:if(r=["image/jpeg","image/png","image/gif","image/webp"],r.includes(a.type)){e.next=7;break}return c.value="Please upload a valid image file (JPEG, PNG, GIF, WEBP)",e.abrupt("return");case 7:if(n=5242880,!(a.size>n)){e.next=11;break}return c.value="Image size must be less than 5MB",e.abrupt("return");case 11:if(e.prev=11,m.value=!0,g.value=0,o.value="",c.value="",s=(0,ha.c7)(),i=(0,C.xI)(),l=i.currentUser,l){e.next=23;break}return c.value="You must be logged in to upload an image",m.value=!1,e.abrupt("return");case 23:if(!k.value||!k.value.startsWith("profile_pictures/")){e.next=33;break}return e.prev=24,d=(0,ha.KR)(s,k.value),e.next=28,(0,ha.XR)(d);case 28:e.next=33;break;case 30:e.prev=30,e.t0=e["catch"](24),console.error("Failed to delete old image:",e.t0);case 33:p=a.name.split(".").pop(),v="".concat(u.value,"_").concat(Date.now(),".").concat(p),h="profile_pictures/".concat(v),b=(0,ha.KR)(s,h),x=(0,ha.bp)(b,a),x.on("state_changed",(function(e){var t=Math.round(e.bytesTransferred/e.totalBytes*100);g.value=t}),(function(e){console.error("Upload error:",e),c.value="Failed to upload image: "+e.message,m.value=!1}),(0,L.A)((0,y.A)().mark((function e(){var t,a;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,ha.qk)(x.snapshot.ref);case 3:return t=e.sent,e.prev=4,e.next=7,(0,C.r7)(l,{photoURL:t});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](4),console.error("Failed to update auth profile:",e.t0);case 12:return a=(0,A.aU)(),e.next=15,(0,A.mZ)((0,A.H9)(a,"users",u.value),{profileImageUrl:t,profileImagePath:h,updatedAt:new Date});case 15:f.value=t,k.value=h,o.value="Profile picture updated successfully!",e.next=24;break;case 20:e.prev=20,e.t1=e["catch"](0),console.error("Error in final upload step:",e.t1),c.value="Failed to complete the upload: "+e.t1.message;case 24:return e.prev=24,m.value=!1,e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[0,20,24,27],[4,9]])})))),e.next=46;break;case 41:e.prev=41,e.t1=e["catch"](11),console.error("Upload handler error:",e.t1),c.value="Failed to process image: "+e.t1.message,m.value=!1;case 46:case"end":return e.stop()}}),e,null,[[11,41],[24,30]])})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,r,n,s;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!m.value){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,o.value="",c.value="",f.value){e.next=8;break}return c.value="No profile picture to remove",e.abrupt("return");case 8:if(m.value=!0,t=(0,ha.c7)(),a=(0,C.xI)(),r=a.currentUser,!k.value||!k.value.startsWith("profile_pictures/")){e.next=22;break}return e.prev=13,n=(0,ha.KR)(t,k.value),e.next=17,(0,ha.XR)(n);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](13),console.error("Error deleting storage image:",e.t0);case 22:if(!r){e.next=31;break}return e.prev=23,e.next=26,(0,C.r7)(r,{photoURL:null});case 26:e.next=31;break;case 28:e.prev=28,e.t1=e["catch"](23),console.error("Error updating auth profile:",e.t1);case 31:return s=(0,A.aU)(),e.next=34,(0,A.mZ)((0,A.H9)(s,"users",u.value),{profileImageUrl:"",profileImagePath:"",updatedAt:new Date});case 34:f.value="",k.value="",o.value="Profile picture removed successfully!",e.next=43;break;case 39:e.prev=39,e.t2=e["catch"](2),console.error("Remove profile picture error:",e.t2),c.value="Failed to remove profile picture: "+e.t2.message;case 43:return e.prev=43,m.value=!1,e.finish(43);case 46:case"end":return e.stop()}}),e,null,[[2,39,43,46],[13,19],[23,28]])})));return function(){return e.apply(this,arguments)}}(),I=function(e){var t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},D=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var n,l,p,v,f;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!m.value){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,o.value="",c.value="",n=(0,C.xI)(),l=n.currentUser,l){e.next=10;break}return c.value="You must be logged in to update your profile",e.abrupt("return");case 10:if(t.value.trim()&&a.value.trim()){e.next=13;break}return c.value="First and last name are required",e.abrupt("return");case 13:return p=(0,A.aU)(),v={FirstName:t.value.trim(),LastName:a.value.trim(),isOnline:!0,updatedAt:new Date},e.next=17,(0,A.mZ)((0,A.H9)(p,"users",u.value),v);case 17:if(!r.value){e.next=53;break}return e.prev=18,f=C.IX.credential(l.email,r.value),e.next=22,(0,C.kZ)(l,f);case 22:if(!s.value){e.next=31;break}if(!(s.value.length<6)){e.next=26;break}return c.value="Password must be at least 6 characters",e.abrupt("return");case 26:return e.next=28,(0,C.f3)(l,s.value);case 28:r.value="",s.value="",o.value="Password updated successfully!";case 31:if(!i.value||i.value===l.email){e.next=44;break}if(I(i.value)){e.next=35;break}return c.value="Please enter a valid email address",e.abrupt("return");case 35:return e.next=37,(0,C.Ww)(l,i.value);case 37:return e.next=39,(0,C.gA)(l);case 39:return e.next=41,(0,A.mZ)((0,A.H9)(p,"users",u.value),{Email:i.value,updatedAt:new Date});case 41:d.value=i.value,o.value=o.value?o.value+" Email updated successfully! Verification email sent.":"Email updated successfully! Verification email sent.",i.value="";case 44:e.next=51;break;case 46:return e.prev=46,e.t0=e["catch"](18),console.error("Authentication error:",e.t0),c.value="Authentication failed: "+e.t0.message,e.abrupt("return");case 51:e.next=56;break;case 53:if(!s.value&&!i.value){e.next=56;break}return c.value="Current password is required to change password or email",e.abrupt("return");case 56:o.value||(o.value="Profile updated successfully!"),e.next=63;break;case 59:e.prev=59,e.t1=e["catch"](2),console.error("Update profile error:",e.t1),c.value="Failed to update profile: "+e.t1.message;case 63:case"end":return e.stop()}}),e,null,[[2,59],[18,46]])})));return function(){return e.apply(this,arguments)}}();return(0,n.sV)((0,L.A)((0,y.A)().mark((function e(){return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:case"end":return e.stop()}}),e)})))),{FirstName:t,LastName:a,oldPass:r,newPass:s,newEmail:i,userId:u,successMessage:o,errorMessage:c,Email:d,emailVerified:p,isOnline:v,profileImageUrl:f,isUploading:m,uploadProgress:g,imageUrlInput:h,updateProfile:D,handleImageUpload:E,removeProfilePicture:U,setImageFromUrl:w,handleImageError:P}}},xa=(0,u.A)(ba,[["render",ka],["__scopeId","data-v-00e37e6f"]]),wa=xa;var ya={class:"forgot-password-container"},La={class:"forgot-password-card"},Ca={class:"form-group"},Aa={class:"input-container"},Pa={key:0,class:"notification success"},Ea={key:1,class:"notification error"};function Ua(e,t,a,s,i,u){var o=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",ya,[(0,n.Lk)("div",La,[t[8]||(t[8]=(0,n.Lk)("h2",{class:"forgot-title"},"Mot de passe oublié ?",-1)),t[9]||(t[9]=(0,n.Lk)("p",{class:"forgot-subtitle"},"Pas de souci, nous vous enverrons les instructions de réinitialisation.",-1)),(0,n.Lk)("div",Ca,[t[3]||(t[3]=(0,n.Lk)("label",{for:"email"},"Adresse e-mail",-1)),(0,n.Lk)("div",Aa,[t[2]||(t[2]=(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"input-icon"},[(0,n.Lk)("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),(0,n.Lk)("polyline",{points:"22,6 12,13 2,6"})],-1)),(0,n.bo)((0,n.Lk)("input",{type:"email",id:"email",placeholder:"Entrez votre e-mail","onUpdate:modelValue":t[0]||(t[0]=function(e){return i.email=e}),class:"form-input"},null,512),[[r.Jo,i.email]])])]),i.successMessage?((0,n.uX)(),(0,n.CE)("div",Pa,[t[4]||(t[4]=(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"notification-icon"},[(0,n.Lk)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),(0,n.Lk)("polyline",{points:"22 4 12 14.01 9 11.01"})],-1)),(0,n.Lk)("span",null,(0,N.v_)(i.successMessage),1)])):(0,n.Q3)("",!0),i.errorMessage?((0,n.uX)(),(0,n.CE)("div",Ea,[t[5]||(t[5]=(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"notification-icon"},[(0,n.Lk)("circle",{cx:"12",cy:"12",r:"10"}),(0,n.Lk)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,n.Lk)("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),(0,n.Lk)("span",null,(0,N.v_)(i.errorMessage),1)])):(0,n.Q3)("",!0),(0,n.Lk)("button",{onClick:t[1]||(t[1]=function(){return u.sendResetEmail&&u.sendResetEmail.apply(u,arguments)}),class:"reset-button"},t[6]||(t[6]=[(0,n.Lk)("span",null,"Réinitialiser le mot de passe",-1),(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"button-icon"},[(0,n.Lk)("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),(0,n.Lk)("polyline",{points:"12 5 19 12 12 19"})],-1)])),(0,n.bF)(o,{to:"/login",class:"back-link"},{default:(0,n.k6)((function(){return t[7]||(t[7]=[(0,n.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"back-icon"},[(0,n.Lk)("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),(0,n.Lk)("polyline",{points:"12 19 5 12 12 5"})],-1),(0,n.eW)(" Retour à la connexion ")])})),_:1})])])}const Ia={name:"ForgotPassword",data:function(){return{email:"",successMessage:"",errorMessage:""}},methods:{sendResetEmail:function(){var e=this;return(0,L.A)((0,y.A)().mark((function t(){var a;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.successMessage="",e.errorMessage="",e.email){t.next=5;break}return e.errorMessage="Please enter your email",t.abrupt("return");case 5:return t.prev=5,a=(0,C.xI)(),t.next=9,(0,C.J1)(a,e.email);case 9:e.successMessage="Password reset email sent! Please check your inbox.",e.email="",t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](5),console.error(t.t0),e.errorMessage=t.t0.message||"Failed to send reset email";case 17:case"end":return t.stop()}}),t,null,[[5,13]])})))()}}},Da=(0,u.A)(Ia,[["render",Ua],["__scopeId","data-v-f727e9e0"]]),Ra=Da;var Ma={class:"discussions-container"},Ka={key:0,class:"loading-indicator"},Xa={key:1,class:"no-discussions"},Fa={key:2,class:"discussions-list"},Na=["onClick"],_a={key:0,class:"discussion-profile-image"},Va=["src"],Sa={class:"discussion-content"},Ba={class:"discussion-title"},Oa={class:"discussion-description"},ja={class:"discussion-meta"},za={class:"message-count"},Ta={key:0,class:"discussion-date"},Ha={key:1,class:"participants-preview"},Ja={class:"participant-avatar"},Qa={key:0,class:"more-participants"};function Wa(e,t,a,r,s,i){return(0,n.uX)(),(0,n.CE)("div",Ma,[t[5]||(t[5]=(0,n.Lk)("h1",{class:"discussions-title"},"Mes discussions",-1)),r.loading?((0,n.uX)(),(0,n.CE)("div",Ka,t[2]||(t[2]=[(0,n.Lk)("div",{class:"spinner"},null,-1),(0,n.Lk)("span",null,"Chargement des discussions...",-1)]))):0===r.discussions.length?((0,n.uX)(),(0,n.CE)("div",Xa,[t[3]||(t[3]=(0,n.Lk)("p",null,"Vous n'avez pas encore de discussions.",-1)),(0,n.Lk)("button",{onClick:t[0]||(t[0]=function(){return r.createNewDiscussion&&r.createNewDiscussion.apply(r,arguments)}),class:"create-discussion-btn"}," Créer une nouvelle discussion ")])):((0,n.uX)(),(0,n.CE)("div",Fa,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.discussions,(function(e){return(0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,N.C4)(["discussion-item",{selected:r.selectedDiscussionId===e.id}]),onClick:function(t){return r.selectDiscussion(e.id)}},[e.profileImageUrl?((0,n.uX)(),(0,n.CE)("div",_a,[(0,n.Lk)("img",{src:e.profileImageUrl,alt:"Profile"},null,8,Va)])):(0,n.Q3)("",!0),(0,n.Lk)("div",Sa,[(0,n.Lk)("h3",Ba,(0,N.v_)(e.title),1),(0,n.Lk)("p",Oa,(0,N.v_)(e.description),1),(0,n.Lk)("div",ja,[(0,n.Lk)("span",za,(0,N.v_)(e.messageCount||0)+" message"+(0,N.v_)(1!==e.messageCount?"s":""),1),e.lastActivity?((0,n.uX)(),(0,n.CE)("span",Ta,(0,N.v_)(r.formatDate(e.lastActivity)),1)):(0,n.Q3)("",!0)])]),r.discussionStatuses[e.id]?((0,n.uX)(),(0,n.CE)("div",Ha,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.getTopParticipants(e.id,3),(function(t,a){return(0,n.uX)(),(0,n.CE)("div",{key:t,class:"participant-indicator",style:(0,N.Tr)({zIndex:10-a})},[(0,n.Lk)("div",Ja,[(0,n.eW)((0,N.v_)(r.getInitials(r.userNames[t]||"?"))+" ",1),(0,n.Lk)("span",{class:(0,N.C4)(["status-dot",{online:r.isUserOnline(e.id,t)}])},null,2)])],4)})),128)),e.participants&&e.participants.length>3?((0,n.uX)(),(0,n.CE)("div",Qa," +"+(0,N.v_)(e.participants.length-3),1)):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)],10,Na)})),128))])),(0,n.Lk)("button",{onClick:t[1]||(t[1]=function(){return r.createNewDiscussion&&r.createNewDiscussion.apply(r,arguments)}),class:"new-discussion-btn"},t[4]||(t[4]=[(0,n.Lk)("span",{class:"plus-icon"},"+",-1)]))])}a(4782);const Ga={emits:["select-discussion"],setup:function(e,t){var a=t.emit,r=(0,fe.KR)([]),s=(0,fe.KR)(!0),i=(0,fe.KR)(null),u=(0,fe.KR)({}),o=(0,fe.KR)({}),c=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,n,i;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=(0,C.xI)(),a=t.currentUser,a){e.next=5;break}return s.value=!1,e.abrupt("return");case 5:try{n=(0,A.aU)(),i=(0,A.P)((0,A.rJ)(n,"discussions"),(0,A.My)("lastActivity","desc")),(0,A.aQ)(i,function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var i,u,c,d,p,v,f,m,g,k,h;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=[],u=(0,pe.A)(t.docs),e.prev=2,u.s();case 4:if((c=u.n()).done){e.next=42;break}if(d=c.value,p=d.data(),!p.participants||!p.participants.includes(a.uid)){e.next=40;break}return v=0,e.prev=9,f=(0,A.rJ)(n,"discussions",d.id,"messages"),e.next=13,(0,A.GG)(f);case 13:m=e.sent,v=m.size,e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](9),console.error("Erreur lors du comptage des messages:",e.t0);case 20:if(i.push({id:d.id,title:p.title,description:p.description,participants:p.participants||[],lastActivity:p.lastActivity,messageCount:v,profileImageUrl:p.profileImageUrl||null}),!p.participants){e.next=40;break}g=(0,pe.A)(p.participants),e.prev=23,g.s();case 25:if((k=g.n()).done){e.next=32;break}if(h=k.value,o.value[h]){e.next=30;break}return e.next=30,l(h);case 30:e.next=25;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e["catch"](23),g.e(e.t1);case 37:return e.prev=37,g.f(),e.finish(37);case 40:e.next=4;break;case 42:e.next=47;break;case 44:e.prev=44,e.t2=e["catch"](2),u.e(e.t2);case 47:return e.prev=47,u.f(),e.finish(47);case 50:r.value=i,s.value=!1;case 52:case"end":return e.stop()}}),e,null,[[2,44,47,50],[9,17],[23,34,37,40]])})));return function(t){return e.apply(this,arguments)}}(),(function(e){console.error("Erreur lors du chargement des discussions:",e),s.value=!1}))}catch(u){console.error("Erreur lors du chargement des discussions:",u),s.value=!1}case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=(0,L.A)((0,y.A)().mark((function e(t){var a,r,n,s,i,u,c;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!o.value[t]){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a=(0,A.aU)(),r=(0,A.H9)(a,"users",t),e.next=7,(0,A.x7)(r);case 7:n=e.sent,n.exists()?(s=n.data(),i="".concat(s.firstName||""," ").concat(s.lastName||"").trim(),o.value[t]=i||s.displayName||s.email||"Utilisateur"):(u=(0,C.xI)(),c=u.currentUser,c&&c.uid===t?o.value[t]=c.displayName||c.email||"Moi":o.value[t]="Utilisateur"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](2),console.error("Erreur lors du chargement de l'utilisateur ".concat(t,":"),e.t0),o.value[t]="Utilisateur";case 15:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),d=function(e){if(!e)return"";try{var t=e.toDate?e.toDate():new Date(e);if(isNaN(t.getTime()))return"";var a=new Date,r=new Date(a);r.setDate(r.getDate()-1);var n=t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear(),s=t.getDate()===r.getDate()&&t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear(),i={hour:"2-digit",minute:"2-digit"};if(n)return"Aujourd'hui, ".concat(t.toLocaleTimeString("fr-FR",i));if(s)return"Hier, ".concat(t.toLocaleTimeString("fr-FR",i));var u={day:"2-digit",month:"2-digit",year:"numeric"};return t.toLocaleDateString("fr-FR",u)+", "+t.toLocaleTimeString("fr-FR",i)}catch(o){return console.error("Error formatting date:",o),""}},p=function(){var e=(0,L.A)((0,y.A)().mark((function e(){var t,a,r,n,s,i,u;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=(0,C.xI)(),a=t.currentUser,a){e.next=5;break}return alert("Vous devez être connecté pour créer une discussion"),e.abrupt("return");case 5:if(r=prompt("Titre de la discussion:"),r){e.next=8;break}return e.abrupt("return");case 8:return n=prompt("Description (optionnelle):"),s=prompt("URL de l'image de profil (optionnelle):"),e.prev=10,i=(0,A.aU)(),e.next=14,(0,A.gS)((0,A.rJ)(i,"discussions"),{title:r,description:n||"",createdAt:(0,A.O5)(),lastActivity:(0,A.O5)(),createdBy:a.uid,participants:[a.uid],profileImageUrl:s||null});case 14:u=e.sent,v(u.id),e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](10),console.error("Erreur lors de la création de la discussion:",e.t0),alert("Une erreur s'est produite lors de la création de la discussion");case 22:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(){return e.apply(this,arguments)}}(),v=function(e){i.value=e,a("select-discussion",e)},f=function(e){e&&e.discussionId&&e.statuses&&(u.value[e.discussionId]=e.statuses)},m=function(e,t){return u.value[e]&&u.value[e][t]&&u.value[e][t].isOnline},g=function(e,t){var a=r.value.find((function(t){return t.id===e}));return a&&a.participants?a.participants.slice(0,t):[]},k=function(e){if(!e)return"?";var t=e.split(" ").filter(Boolean);return 0===t.length?"?":1===t.length?t[0].charAt(0).toUpperCase():(t[0].charAt(0)+t[t.length-1].charAt(0)).toUpperCase()};return(0,n.sV)((function(){c()})),{discussions:r,loading:s,selectedDiscussionId:i,discussionStatuses:u,userNames:o,selectDiscussion:v,createNewDiscussion:p,formatDate:d,updateDiscussionStatuses:f,isUserOnline:m,getTopParticipants:g,getInitials:k}}},qa=(0,u.A)(Ga,[["render",Wa],["__scopeId","data-v-c8704cb8"]]),Za=qa;var Ya=[{path:"/",name:"HomeView",component:k},{path:"/login",name:"Login",component:U},{path:"/signup",name:"SignUp",component:F},{path:"/forum/:id",name:"Forum",component:Tt},{path:"/profile/:id",name:"Profile",component:wa},{path:"/forgot",name:"Forgot",component:Ra},{path:"/disc/:id",name:"discussion",component:Fe},{path:"/resp/:id",name:"responses",component:Ot},{path:"/for/:id",name:"forumPage",component:Za,children:[{path:"",components:{leftPanel:Tt,rightPanel:Ot}}]}],$a=(0,l.aE)({history:(0,l.LA)(),routes:Ya});const er=$a;$a.beforeEach((function(e,t,a){var r=(0,C.xI)(),n="Home"===e.name;(0,C.hg)(r,(function(e){n&&!e?a("/"):a()}))}));var tr=a(6400),ar={apiKey:"AIzaSyCfFcRBxn933Kzcy9fz65bwBsdDB2vUtYw",authDomain:"chitchat-f4cec.firebaseapp.com",projectId:"chitchat-f4cec",storageBucket:"chitchat-f4cec.firebasestorage.app",messagingSenderId:"1017286912746",appId:"1:1017286912746:web:a4c429e8ba16f862274593",measurementId:"G-6FQS0RD2S2"};(0,tr.Wp)(ar),(0,r.Ef)(c).use(er).mount("#app")}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,a),s.exports}a.m=e,(()=>{var e=[];a.O=(t,r,n,s)=>{if(!r){var i=1/0;for(l=0;l<e.length;l++){for(var[r,n,s]=e[l],u=!0,o=0;o<r.length;o++)(!1&s||i>=s)&&Object.keys(a.O).every((e=>a.O[e](r[o])))?r.splice(o--,1):(u=!1,s<i&&(i=s));if(u){e.splice(l--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[r,n,s]}})(),(()=>{a.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return a.d(t,{a:t}),t}})(),(()=>{a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={524:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var n,s,[i,u,o]=r,c=0;if(i.some((t=>0!==e[t]))){for(n in u)a.o(u,n)&&(a.m[n]=u[n]);if(o)var l=o(a)}for(t&&t(r);c<i.length;c++)s=i[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(l)},r=self["webpackChunkchatting"]=self["webpackChunkchatting"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=a.O(void 0,[504],(()=>a(5129)));r=a.O(r)})();
//# sourceMappingURL=app.f64392a3.js.map